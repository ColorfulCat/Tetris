<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>æ•°å­—é­”æ–¹</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      touch-action: manipulation;
      user-select: none;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
      overflow-x: hidden;
      position: relative;
      padding: 20px;
    }
    
    .game-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
      position: relative;
      z-index: 10;
      width: 100%;
      max-width: 500px;
    }
    
    .header-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
      margin-bottom: 10px;
    }
    
    .title {
      font-size: 36px;
      font-weight: bold;
      text-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
      margin-bottom: 10px;
    }
    
    .difficulty-section {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }
    
    .difficulty-btn {
      padding: 10px 20px;
      background: rgba(0, 0, 0, 0.4);
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 20px;
      color: white;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .difficulty-btn.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-color: #667eea;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }
    
    .difficulty-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 255, 255, 0.2);
    }
    
    .stats-section {
      display: flex;
      gap: 20px;
      align-items: center;
      flex-wrap: wrap;
      justify-content: center;
    }
    
    .stat-box {
      background: rgba(0, 0, 0, 0.6);
      border-radius: 15px;
      padding: 12px 20px;
      text-align: center;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
      min-width: 100px;
    }
    
    .stat-title {
      font-size: 12px;
      color: #a0a0a0;
      margin-bottom: 5px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .stat-value {
      font-size: 24px;
      font-weight: bold;
      color: #fff;
    }
    
    .game-board {
      background: rgba(0, 0, 0, 0.6);
      border-radius: 15px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
      padding: 15px;
      position: relative;
    }
    
    #gameGrid {
      background: rgba(187, 173, 160, 0.4);
      border-radius: 8px;
      position: relative;
      display: grid;
      gap: 8px;
      padding: 10px;
      transition: all 0.3s ease;
    }
    
    .grid-cell {
      background: rgba(238, 228, 218, 0.35);
      border-radius: 6px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      overflow: visible;
    }
    
    .grid-cell:hover {
      background: rgba(238, 228, 218, 0.5);
      transform: scale(1);
    }
    
    .grid-cell:active {
      transform: scale(1);
    }
    
    .number {
      background: white;
      color: #333;
      border-radius: 6px;
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: bold;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      position: absolute;
      top: 0;
      left: 0;
    }
    
    .number.moving {
      z-index: 100;
      transform: scale(1.1);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
    }
    
    /* æŠ–åŠ¨åŠ¨ç”» */
    .number.shake {
      animation: shake 0.3s ease-in-out;
    }
    
    @keyframes shake {
      0%, 100% {
        transform: translateX(0);
      }
      25% {
        transform: translateX(-3px);
      }
      75% {
        transform: translateX(3px);
      }
    }
    
    .control-section {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      justify-content: center;
    }
    
    .control-btn {
      padding: 15px 30px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 25px;
      font-size: 16px;
      font-weight: bold;
      color: white;
      text-align: center;
      box-shadow: 
        0 8px 25px rgba(102, 126, 234, 0.4),
        inset 0 2px 4px rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      position: relative;
      overflow: hidden;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .control-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s;
    }
    
    .control-btn:hover {
      transform: translateY(-3px);
      box-shadow: 
        0 12px 35px rgba(102, 126, 234, 0.6),
        inset 0 2px 4px rgba(255, 255, 255, 0.3);
      background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
    }
    
    .control-btn:hover::before {
      left: 100%;
    }
    
    .control-btn:active {
      transform: translateY(-1px) scale(0.98);
    }
    
    .game-win {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 20;
      display: none;
    }
    
    .game-win h2 {
      font-size: 48px;
      color: #50C878;
      margin-bottom: 30px;
      text-shadow: 0 0 10px rgba(80, 200, 120, 0.5);
    }
    
    .final-stats {
      font-size: 24px;
      margin-bottom: 30px;
      text-align: center;
    }
    
    .restart-btn {
      padding: 18px 50px;
      background: linear-gradient(to right, #50C878, #32CD32);
      border-radius: 30px;
      font-size: 22px;
      font-weight: bold;
      color: white;
      box-shadow: 0 8px 25px rgba(80, 200, 120, 0.4);
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .restart-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 35px rgba(80, 200, 120, 0.6);
    }
    
    /* ç¡®è®¤å¼¹çª—æ ·å¼ */
    .confirm-dialog {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 30;
      display: none;
    }
    
    .confirm-content {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 20px;
      padding: 30px;
      text-align: center;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
      max-width: 400px;
      width: 90%;
    }
    
    .confirm-title {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 15px;
      color: white;
    }
    
    .confirm-message {
      font-size: 16px;
      margin-bottom: 25px;
      color: rgba(255, 255, 255, 0.9);
      line-height: 1.5;
    }
    
    .confirm-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
    }
    
    .confirm-btn {
      padding: 12px 25px;
      border: none;
      border-radius: 15px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      min-width: 80px;
    }
    
    .confirm-btn.yes {
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
      color: white;
    }
    
    .confirm-btn.no {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: 2px solid rgba(255, 255, 255, 0.3);
    }
    
    .confirm-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
    }
    
    /* èƒŒæ™¯åŠ¨ç”» */
    .background {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      z-index: 1;
    }
    
    .shape {
      position: absolute;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      animation: float 15s infinite linear;
    }
    
    @keyframes float {
      0% {
        transform: translateY(0) rotate(0deg);
      }
      100% {
        transform: translateY(-100vh) rotate(360deg);
      }
    }
    
    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 480px) {
      .title {
        font-size: 28px;
      }
      
      .difficulty-btn {
        padding: 8px 16px;
        font-size: 14px;
      }
      
      .control-btn {
        padding: 12px 24px;
        font-size: 14px;
      }
      
      .stat-box {
        padding: 10px 16px;
        min-width: 80px;
      }
      
      .stat-value {
        font-size: 20px;
      }
      
      .confirm-content {
        padding: 25px;
      }
      
      .confirm-title {
        font-size: 20px;
      }
      
      .confirm-message {
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <div class="background" id="background"></div>
  
  <div class="game-container">
    <div class="header-section">
      <h1 class="title">æ•°å­—é­”æ–¹</h1>
      
      <div class="difficulty-section">
        <button class="difficulty-btn active" data-size="3">3Ã—3</button>
        <button class="difficulty-btn" data-size="4">4Ã—4</button>
        <button class="difficulty-btn" data-size="5">5Ã—5</button>
      </div>
    </div>
    
    <div class="stats-section">
      <div class="stat-box">
        <div class="stat-title">æ­¥æ•°</div>
        <div class="stat-value" id="moves">0</div>
      </div>
      
      <div class="stat-box">
        <div class="stat-title">æœ€ä½³</div>
        <div class="stat-value" id="bestMoves">-</div>
      </div>
    </div>
    
    <div class="game-board">
      <div id="gameGrid"></div>
    </div>
    
    <div class="control-section">
      <button class="control-btn" id="newGameBtn">æ–°æ¸¸æˆ</button>
    </div>
  </div>
  
  <div class="game-win" id="gameWin">
    <h2>æ­å–œå®Œæˆï¼</h2>
    <div class="final-stats">
      <div>ç”¨æ—¶æ­¥æ•°: <span id="finalMoves">0</span></div>
      <div id="newRecord" style="color: #FFD700; margin-top: 10px; display: none;">ğŸ‰ æ–°çºªå½•ï¼</div>
    </div>
    <button class="restart-btn" id="restartBtn">å†æ¥ä¸€å±€</button>
  </div>
  
  <!-- ç¡®è®¤å¼¹çª— -->
  <div class="confirm-dialog" id="confirmDialog">
    <div class="confirm-content">
      <div class="confirm-title">ç¡®è®¤æ–°æ¸¸æˆ</div>
      <div class="confirm-message">å½“å‰æ¸¸æˆè¿›åº¦å°†ä¼šä¸¢å¤±ï¼Œç¡®å®šè¦å¼€å§‹æ–°æ¸¸æˆå—ï¼Ÿ</div>
      <div class="confirm-buttons">
        <button class="confirm-btn yes" id="confirmYes">ç¡®å®š</button>
        <button class="confirm-btn no" id="confirmNo">å–æ¶ˆ</button>
      </div>
    </div>
  </div>

  <script>
    // æ¸¸æˆçŠ¶æ€
    let gridSize = 3;
    let board = [];
    let moves = 0;
    let bestMoves = {};
    let gameCompleted = false;
    let isAnimating = false;
    
    // åˆå§‹åŒ–æ¸¸æˆ
    function init() {
      createBackground();
      loadBestMoves();
      setupEventListeners();
      newGame();
    }
    
    // åˆ›å»ºåŠ¨æ€èƒŒæ™¯
    function createBackground() {
      const bg = document.getElementById('background');
      const colors = ['rgba(255,255,255,0.05)', 'rgba(255,255,255,0.03)', 'rgba(255,255,255,0.02)'];
      
      for (let i = 0; i < 20; i++) {
        const shape = document.createElement('div');
        shape.classList.add('shape');
        
        const size = Math.random() * 100 + 50;
        shape.style.width = `${size}px`;
        shape.style.height = `${size}px`;
        shape.style.left = `${Math.random() * 100}%`;
        shape.style.top = `${Math.random() * 100}%`;
        shape.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        shape.style.animationDuration = `${Math.random() * 30 + 15}s`;
        shape.style.animationDelay = `${Math.random() * 5}s`;
        
        bg.appendChild(shape);
      }
    }
    
    // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
    function setupEventListeners() {
      // éš¾åº¦é€‰æ‹©
      document.querySelectorAll('.difficulty-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          if (isAnimating) return;
          document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          gridSize = parseInt(btn.dataset.size);
          newGame();
        });
      });
      
      // æ–°æ¸¸æˆæŒ‰é’® - æ˜¾ç¤ºç¡®è®¤å¼¹çª—
      document.getElementById('newGameBtn').addEventListener('click', () => {
        if (!isAnimating) {
          if (moves > 0 && !gameCompleted) {
            showConfirmDialog();
          } else {
            startNewGame();
          }
        }
      });
      
      // ç¡®è®¤å¼¹çª—æŒ‰é’®
      document.getElementById('confirmYes').addEventListener('click', () => {
        hideConfirmDialog();
        startNewGame();
      });
      
      document.getElementById('confirmNo').addEventListener('click', () => {
        hideConfirmDialog();
      });
      
      // èƒœåˆ©ç•Œé¢é‡æ–°å¼€å§‹æŒ‰é’®
      document.getElementById('restartBtn').addEventListener('click', () => {
        if (!isAnimating) startNewGame();
      });
    }
    
    // æ˜¾ç¤ºç¡®è®¤å¼¹çª—
    function showConfirmDialog() {
      document.getElementById('confirmDialog').style.display = 'flex';
    }
    
    // éšè—ç¡®è®¤å¼¹çª—
    function hideConfirmDialog() {
      document.getElementById('confirmDialog').style.display = 'none';
    }
    
    // æ–°æ¸¸æˆï¼ˆå†…éƒ¨å‡½æ•°ï¼‰
    function startNewGame() {
      moves = 0;
      gameCompleted = false;
      isAnimating = false;
      updateMoves();
      updateBestMoves();
      document.getElementById('gameWin').style.display = 'none';
      
      // åˆ›å»ºæœ‰åºæ•°ç»„ï¼ˆæ‰€æœ‰ä½ç½®éƒ½æœ‰æ•°å­—ï¼‰
      board = [];
      for (let i = 0; i < gridSize; i++) {
        board[i] = [];
        for (let j = 0; j < gridSize; j++) {
          board[i][j] = i * gridSize + j + 1;
        }
      }
      
      // å…ˆæ›´æ–°æ˜¾ç¤ºï¼Œå†æ‰“ä¹±æ£‹ç›˜
      updateDisplay();
      setTimeout(() => {
        shuffleBoard();
      }, 50);
    }
    
    // æ–°æ¸¸æˆï¼ˆå¯¹å¤–æ¥å£ï¼‰
    function newGame() {
      startNewGame();
    }
    
    // æ‰“ä¹±æ£‹ç›˜
    function shuffleBoard() {
      // æ‰§è¡Œéšæœºæ—‹è½¬æ“ä½œæ¥æ‰“ä¹±
      for (let i = 0; i < gridSize * gridSize * 3; i++) {
        const row = Math.floor(Math.random() * (gridSize - 1));
        const col = Math.floor(Math.random() * (gridSize - 1));
        rotateCounterClockwiseData(row, col); // åªä¿®æ”¹æ•°æ®ï¼Œä¸åšåŠ¨ç”»
      }
      updateDisplay();
    }
    
    // åªä¿®æ”¹æ•°æ®çš„æ—‹è½¬å‡½æ•°
    function rotateCounterClockwiseData(row, col) {
      if (row >= gridSize - 1 || col >= gridSize - 1) return;
      
      // è·å–2x2åŒºåŸŸçš„å››ä¸ªå€¼
      const topLeft = board[row][col];
      const topRight = board[row][col + 1];
      const bottomLeft = board[row + 1][col];
      const bottomRight = board[row + 1][col + 1];
      
      // é€†æ—¶é’ˆæ—‹è½¬æ•°æ®ï¼šå·¦ä¸Š->å·¦ä¸‹ï¼Œå·¦ä¸‹->å³ä¸‹ï¼Œå³ä¸‹->å³ä¸Šï¼Œå³ä¸Š->å·¦ä¸Š
      board[row][col] = topRight;           // å·¦ä¸Š <- å³ä¸Š
      board[row][col + 1] = bottomRight;    // å³ä¸Š <- å³ä¸‹
      board[row + 1][col] = topLeft;        // å·¦ä¸‹ <- å·¦ä¸Š
      board[row + 1][col + 1] = bottomLeft; // å³ä¸‹ <- å·¦ä¸‹
    }
    
    // æ›´æ–°æ˜¾ç¤º
    function updateDisplay() {
      const gameGrid = document.getElementById('gameGrid');
      
      // è®¾ç½®ç½‘æ ¼å¤§å°
      const cellSize = Math.min(300 / gridSize, 80);
      gameGrid.style.gridTemplateColumns = `repeat(${gridSize}, ${cellSize}px)`;
      gameGrid.style.gridTemplateRows = `repeat(${gridSize}, ${cellSize}px)`;
      gameGrid.style.width = `${cellSize * gridSize + (gridSize - 1) * 8 + 20}px`;
      gameGrid.style.height = `${cellSize * gridSize + (gridSize - 1) * 8 + 20}px`;
      
      // æ¸…ç©ºç½‘æ ¼
      gameGrid.innerHTML = '';
      
      // åˆ›å»ºæ ¼å­
      for (let i = 0; i < gridSize; i++) {
        for (let j = 0; j < gridSize; j++) {
          const cell = document.createElement('div');
          cell.className = 'grid-cell';
          cell.style.width = `${cellSize}px`;
          cell.style.height = `${cellSize}px`;
          cell.style.fontSize = `${cellSize * 0.4}px`;
          cell.style.position = 'relative';
          
          const number = document.createElement('div');
          number.className = 'number';
          number.textContent = board[i][j];
          number.style.width = `${cellSize}px`;
          number.style.height = `${cellSize}px`;
          number.style.fontSize = `${cellSize * 0.4}px`;
          cell.appendChild(number);
          
          // æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼ˆåªæœ‰éè¾¹ç•Œä½ç½®æ‰èƒ½ç‚¹å‡»ï¼‰
          if (i < gridSize - 1 && j < gridSize - 1) {
            cell.addEventListener('click', () => {
              if (!gameCompleted && !isAnimating) {
                rotateCounterClockwise(i, j, true);
              }
            });
          } else {
            // ä¸ºè¾¹ç•Œä½ç½®æ·»åŠ æŠ–åŠ¨æ•ˆæœ
            cell.addEventListener('click', () => {
              if (!gameCompleted && !isAnimating) {
                const numberElement = cell.querySelector('.number');
                if (numberElement) {
                  // ç§»é™¤ä¹‹å‰çš„æŠ–åŠ¨ç±»ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
                  numberElement.classList.remove('shake');
                  // å¼ºåˆ¶é‡ç»˜
                  void numberElement.offsetWidth;
                  // æ·»åŠ æŠ–åŠ¨ç±»
                  numberElement.classList.add('shake');
                  // åŠ¨ç”»ç»“æŸåç§»é™¤ç±»
                  setTimeout(() => {
                    numberElement.classList.remove('shake');
                  }, 300);
                }
              }
            });
          }
          gameGrid.appendChild(cell);
        }
      }
    }
    
    // é€†æ—¶é’ˆæ—‹è½¬2x2åŒºåŸŸ
    function rotateCounterClockwise(row, col, countMove = true) {
      if (row >= gridSize - 1 || col >= gridSize - 1 || isAnimating) return;
      
      isAnimating = true;
      
      // è·å–ç›¸å…³çš„DOMå…ƒç´ ï¼ˆåœ¨ä¿®æ”¹æ•°æ®ä¹‹å‰ï¼‰
      const cells = document.querySelectorAll('.grid-cell');
      const indices = [
        row * gridSize + col,
        row * gridSize + col + 1,
        (row + 1) * gridSize + col,
        (row + 1) * gridSize + col + 1
      ];
      
      const cellElements = indices.map(index => cells[index]);
      const numberElements = cellElements.map(cell => {
        if (cell) {
          return cell.querySelector('.number');
        }
        return null;
      }).filter(el => el !== null);
      
      // å¦‚æœæ²¡æœ‰æ‰¾åˆ°è¶³å¤Ÿçš„å…ƒç´ ï¼Œç›´æ¥æ›´æ–°æ˜¾ç¤º
      if (numberElements.length < 4) {
        rotateCounterClockwiseData(row, col);
        updateDisplay();
        isAnimating = false;
        if (countMove) {
          moves++;
          updateMoves();
          checkWin();
        }
        return;
      }
      
      // ä¿å­˜åŸå§‹æ•°å­—å†…å®¹ï¼ˆç”¨äºåŠ¨ç”»æ˜¾ç¤ºï¼‰
      const originalNumbers = numberElements.map(el => el.textContent);
      
      // å…ˆä¿®æ”¹æ•°æ®
      rotateCounterClockwiseData(row, col);
      
      // è®¡ç®—ä½ç§»è·ç¦»
      const cellSize = Math.min(300 / gridSize, 80);
      const gap = 8;
      const moveDistance = cellSize + gap;
      
      // è·å–æ¸¸æˆç½‘æ ¼çš„ä½ç½®ä¿¡æ¯ï¼Œç”¨äºè®¡ç®—ç»å¯¹ä½ç½®
      const gameGrid = document.getElementById('gameGrid');
      const gridRect = gameGrid.getBoundingClientRect();
      const gameBoard = document.querySelector('.game-board');
      const boardRect = gameBoard.getBoundingClientRect();
      
      // è®¡ç®—ç›¸å¯¹äºæ¸¸æˆæ¿çš„åç§»
      const offsetX = gridRect.left - boardRect.left;
      const offsetY = gridRect.top - boardRect.top;
      
      // ä¸ºæ¯ä¸ªæ•°å­—å…ƒç´ åˆ›å»ºç»å¯¹å®šä½çš„å…‹éš†è¿›è¡ŒåŠ¨ç”»
      const animatingElements = [];
      numberElements.forEach((number, index) => {
        const clone = number.cloneNode(true);
        clone.classList.add('moving');
        
        // ä½¿ç”¨åŸå§‹æ•°å­—å†…å®¹
        clone.textContent = originalNumbers[index];
        
        // è®¡ç®—å½“å‰ä½ç½®
        const currentRow = Math.floor(indices[index] / gridSize);
        const currentCol = indices[index] % gridSize;
        const currentX = offsetX + 10 + currentCol * (cellSize + gap);
        const currentY = offsetY + 10 + currentRow * (cellSize + gap);
        
        // è®¾ç½®ç»å¯¹å®šä½
        clone.style.position = 'absolute';
        clone.style.left = `${currentX}px`;
        clone.style.top = `${currentY}px`;
        clone.style.zIndex = '100';
        
        // æ·»åŠ åˆ°æ¸¸æˆæ¿
        gameBoard.appendChild(clone);
        animatingElements.push(clone);
        
        // ç«‹å³æ›´æ–°åŸå§‹å…ƒç´ çš„æ•°å­—å†…å®¹ï¼ˆæ˜¾ç¤ºæœ€ç»ˆç»“æœï¼‰
        number.textContent = board[Math.floor(indices[index] / gridSize)][indices[index] % gridSize];
        // éšè—åŸå§‹å…ƒç´ 
        number.style.opacity = '0';
        number.style.transition = 'opacity 0.1s ease';
      });
      
      // è®¾ç½®é€†æ—¶é’ˆä½ç§»åŠ¨ç”»
      setTimeout(() => {
        // é€†æ—¶é’ˆæ—‹è½¬ï¼šå·¦ä¸Š->å·¦ä¸‹ï¼Œå³ä¸Š->å·¦ä¸Šï¼Œå³ä¸‹->å³ä¸Šï¼Œå·¦ä¸‹->å³ä¸‹
        animatingElements[0].style.transform = `translate(0, ${moveDistance}px)`; // å·¦ä¸Š -> å·¦ä¸‹
        animatingElements[1].style.transform = `translate(-${moveDistance}px, 0)`; // å³ä¸Š -> å·¦ä¸Š
        animatingElements[2].style.transform = `translate(${moveDistance}px, 0)`; // å·¦ä¸‹ -> å³ä¸‹
        animatingElements[3].style.transform = `translate(0, -${moveDistance}px)`; // å³ä¸‹ -> å³ä¸Š
      }, 10);
      
      // åŠ¨ç”»å®Œæˆåæ¸…ç†
      setTimeout(() => {
        // å…ˆè®©åŠ¨ç”»å…ƒç´ æ·¡å‡º
        animatingElements.forEach(element => {
          element.style.opacity = '0';
          element.style.transition = 'opacity 0s ease';
        });
        
        // ç¨å¾®å»¶è¿Ÿåç§»é™¤åŠ¨ç”»å…ƒç´ å¹¶æ˜¾ç¤ºåŸå§‹å…ƒç´ 
        setTimeout(() => {
          // ç§»é™¤åŠ¨ç”»å…ƒç´ 
          animatingElements.forEach(element => {
            if (element.parentNode) {
              element.parentNode.removeChild(element);
            }
          });
          
          // æ¢å¤åŸå§‹å…ƒç´ æ˜¾ç¤º
          numberElements.forEach(number => {
            number.style.opacity = '1';
            number.style.transition = 'opacity 0s ease';
          });
          
          // æ¸…ç†è¿‡æ¸¡æ•ˆæœ
          setTimeout(() => {
            numberElements.forEach(number => {
              number.style.transition = 'all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
            });
          }, 0);
          
          isAnimating = false;
          
          if (countMove) {
            moves++;
            updateMoves();
            checkWin();
          }
        }, 0);
      }, 400);
    }
    
    // æ£€æŸ¥æ˜¯å¦è·èƒœ
    function checkWin() {
      let expected = 1;
      for (let i = 0; i < gridSize; i++) {
        for (let j = 0; j < gridSize; j++) {
          if (board[i][j] !== expected) return false;
          expected++;
        }
      }
      
      // æ¸¸æˆå®Œæˆ
      gameCompleted = true;
      document.getElementById('finalMoves').textContent = moves;
      
      // æ£€æŸ¥æ˜¯å¦æ˜¯æ–°çºªå½•
      const currentBest = bestMoves[gridSize];
      if (!currentBest || moves < currentBest) {
        bestMoves[gridSize] = moves;
        saveBestMoves();
        updateBestMoves();
        document.getElementById('newRecord').style.display = 'block';
      } else {
        document.getElementById('newRecord').style.display = 'none';
      }
      
      setTimeout(() => {
        document.getElementById('gameWin').style.display = 'flex';
      }, 500);
      
      return true;
    }
    
    // æ›´æ–°æ­¥æ•°æ˜¾ç¤º
    function updateMoves() {
      document.getElementById('moves').textContent = moves;
    }
    
    // æ›´æ–°æœ€ä½³æ­¥æ•°æ˜¾ç¤º
    function updateBestMoves() {
      const best = bestMoves[gridSize];
      document.getElementById('bestMoves').textContent = best ? best : '-';
    }
    
    // ä¿å­˜æœ€ä½³æ­¥æ•°
    function saveBestMoves() {
      localStorage.setItem('numberCube-bestMoves', JSON.stringify(bestMoves));
    }
    
    // åŠ è½½æœ€ä½³æ­¥æ•°
    function loadBestMoves() {
      const saved = localStorage.getItem('numberCube-bestMoves');
      if (saved) {
        bestMoves = JSON.parse(saved);
      } else {
        bestMoves = {};
      }
    }
    
    // åˆå§‹åŒ–æ¸¸æˆ
    init();
  </script>
</body>
</html>