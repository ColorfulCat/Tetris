<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>å¾·å·æ‰‘å…‹</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      touch-action: manipulation;
      user-select: none;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: white;
      overflow-x: hidden;
      position: relative;
      padding: 10px;
    }
    
    .game-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
      position: relative;
      z-index: 10;
      width: 100%;
      max-width: 800px;
    }
    
    /* é¡¶éƒ¨åŒºåŸŸæ ·å¼ */
    .top-area {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      margin-bottom: 15px;
    }
    
    /* æ–°æ¸¸æˆæŒ‰é’®é¡¶éƒ¨æ ·å¼ */
    .top-new-game-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 12px 24px;
      border-radius: 25px;
      font-size: 16px;
      font-weight: bold;
      color: white;
      text-align: center;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 1px;
      min-width: 100px;
      position: relative;
    }
    
    .top-new-game-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
    }
    
    .top-new-game-btn:active {
      transform: translateY(0);
    }
    
    .game-info {
      display: flex;
      justify-content: center;
      gap: 20px;
      flex: 1;
      max-width: 600px;
    }
    
    .info-box {
      background: rgba(0, 0, 0, 0.6);
      border-radius: 15px;
      padding: 15px 20px;
      text-align: center;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
      flex: 1;
      min-width: 120px;
    }
    
    .info-title {
      font-size: 12px;
      color: #a0a0a0;
      margin-bottom: 5px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .info-value {
      font-size: 20px;
      font-weight: bold;
      color: #fff;
    }
    
    .ai-area {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }
    
    .ai-label {
      font-size: 18px;
      font-weight: bold;
      color: #ff6b6b;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    }
    
    .ai-cards {
      display: flex;
      gap: 10px;
    }
    
    .community-area {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
      background: rgba(0, 0, 0, 0.6);
      border-radius: 15px;
      padding: 15px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
      margin: 20px 0;
    }
    
    .community-label {
      font-size: 16px;
      color: #a0a0a0;
      text-transform: uppercase;
      letter-spacing: 2px;
    }
    
    .community-cards {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: center;
    }
    
    .player-area {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      margin-top: 10px;
    }
    
    .player-label {
      font-size: 18px;
      font-weight: bold;
      color: #4ecdc4;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    }
    
    .player-cards {
      display: flex;
      gap: 10px;
    }
    
    .card {
      width: 60px;
      height: 84px;
      background: white;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
      padding: 5px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
      position: relative;
      font-weight: bold;
      transform-style: preserve-3d;
    }
    
    .card.hidden {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .card.hidden::after {
      content: 'ğŸ‚ ';
      font-size: 30px;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
    
    .card.flipping {
      animation: cardFlip 0.6s ease-in-out;
    }
    
    @keyframes cardFlip {
      0% {
        transform: rotateY(0deg);
      }
      50% {
        transform: rotateY(90deg);
      }
      100% {
        transform: rotateY(0deg);
      }
    }
    
    .card-rank {
      font-size: 14px;
      font-weight: bold;
    }
    
    .card-suit {
      font-size: 20px;
    }
    
    .card.red {
      color: #e74c3c;
    }
    
    .card.black {
      color: #2c3e50;
    }
    
    .action-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 20px;
      width: 100%;
    }
    
    .action-btn {
      padding: 12px 20px;
      border-radius: 20px;
      font-size: 16px;
      font-weight: bold;
      color: white;
      text-align: center;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 1px;
      min-width: 80px;
    }
    
    .action-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .fold-btn {
      background: linear-gradient(135deg, #e74c3c, #c0392b);
    }
    
    .call-btn {
      background: linear-gradient(135deg, #f39c12, #e67e22);
    }
    
    .raise-btn {
      background: linear-gradient(135deg, #27ae60, #229954);
    }
    
    .check-btn {
      background: linear-gradient(135deg, #3498db, #2980b9);
    }
    
    .action-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
    }
    
    .action-btn:active:not(:disabled) {
      transform: translateY(0);
    }
    
    .pot-info {
      text-align: center;
      margin: 15px 0;
      font-size: 18px;
      font-weight: bold;
      color: #f1c40f;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    }
    
    .game-status {
      text-align: center;
      margin: 10px 0;
      font-size: 16px;
      color: #ecf0f1;
      min-height: 24px;
    }
    
    .hand-strength {
      font-size: 14px;
      color: #95a5a6;
      margin-top: 5px;
      text-align: center;
    }
    
    /* èƒŒæ™¯åŠ¨ç”» */
    .background {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      z-index: 1;
    }
    
    .shape {
      position: absolute;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      animation: float 15s infinite linear;
    }
    
    @keyframes float {
      0% {
        transform: translateY(0) rotate(0deg);
      }
      100% {
        transform: translateY(-100vh) rotate(360deg);
      }
    }
    
    /* è‡ªå®šä¹‰å¼¹çª—æ ·å¼ */
    .custom-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      backdrop-filter: blur(10px);
    }
    
    .modal-content {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 20px;
      padding: 30px;
      text-align: center;
      color: white;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      border: 2px solid rgba(255, 255, 255, 0.3);
      max-width: 90%;
      min-width: 300px;
    }
    
    .modal-title {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 15px;
      color: #ffd700;
    }
    
    .modal-message {
      font-size: 16px;
      margin-bottom: 25px;
      line-height: 1.5;
    }
    
    .modal-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
    }
    
    .modal-btn {
      padding: 12px 24px;
      border: none;
      border-radius: 25px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      min-width: 100px;
    }
    
    .modal-btn.confirm {
      background: linear-gradient(135deg, #ff6b6b, #ee5a52);
      color: white;
    }
    
    .modal-btn.cancel {
      background: linear-gradient(135deg, #4ecdc4, #44a08d);
      color: white;
    }
    
    .modal-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    }
    
    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 480px) {
      .top-area {
        flex-direction: column;
        gap: 15px;
        align-items: stretch;
      }
      
      .game-info {
        order: 2;
      }
      
      .top-new-game-btn {
        order: 1;
        align-self: center;
        padding: 10px 20px;
        font-size: 14px;
        min-width: 90px;
      }
      
      .card {
        width: 50px;
        height: 70px;
        padding: 3px;
      }
      
      .card-rank {
        font-size: 12px;
      }
      
      .card-suit {
        font-size: 16px;
      }
      
      .action-btn {
        padding: 10px 15px;
        font-size: 14px;
        min-width: 70px;
      }
      
      .info-value {
        font-size: 18px;
      }
      
      .community-cards {
        gap: 5px;
      }
      
      .ai-cards, .player-cards {
        gap: 8px;
      }
      
      .modal-content {
        padding: 20px;
        min-width: 280px;
      }
      
      .modal-title {
        font-size: 20px;
      }
      
      .modal-message {
        font-size: 14px;
      }
      
      .modal-btn {
        padding: 10px 20px;
        font-size: 14px;
        min-width: 80px;
      }
      
      .winner-text {
        font-size: 28px;
      }
      
      .winner-details {
        font-size: 16px;
      }
      
      .winner-card {
        width: 40px;
        height: 56px;
        padding: 3px;
      }
      
      .winner-card-rank {
        font-size: 10px;
      }
      
      .winner-card-suit {
        font-size: 14px;
      }
      
      .winner-cards-row {
        gap: 5px;
      }
      
      .next-round-btn {
        padding: 12px 24px;
        font-size: 16px;
      }
    }
    
    .winner-announcement {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 100;
      display: none;
      padding: 20px;
      overflow-y: auto;
    }
    
    .winner-text {
      font-size: 36px;
      font-weight: bold;
      margin-bottom: 20px;
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
    }
    
    .winner-details {
      font-size: 18px;
      margin-bottom: 30px;
      text-align: center;
    }
    
    /* å®Œç»“å¼¹çª—ä¸­çš„ç‰Œé¢å±•ç¤ºåŒºåŸŸ */
    .winner-cards-container {
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin: 20px 0;
      width: 100%;
      max-width: 600px;
    }
    
    .winner-player-section {
      background: rgba(0, 0, 0, 0.6);
      border-radius: 15px;
      padding: 15px;
      text-align: center;
    }
    
    .winner-player-label {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 10px;
      color: #4ecdc4;
    }
    
    .winner-player-label.ai {
      color: #ff6b6b;
    }
    
    .winner-cards-row {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-bottom: 10px;
    }
    
    .winner-card {
      width: 50px;
      height: 70px;
      background: white;
      border-radius: 6px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
      padding: 4px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      font-weight: bold;
      font-size: 12px;
    }
    
    .winner-card.red {
      color: #e74c3c;
    }
    
    .winner-card.black {
      color: #2c3e50;
    }
    
    .winner-card-rank {
      font-size: 11px;
      font-weight: bold;
    }
    
    .winner-card-suit {
      font-size: 16px;
    }
    
    .winner-hand-strength {
      font-size: 14px;
      color: #f1c40f;
      font-weight: bold;
    }
    
    .winner-community-section {
      background: rgba(0, 0, 0, 0.6);
      border-radius: 15px;
      padding: 15px;
      text-align: center;
    }
    
    .winner-community-label {
      font-size: 16px;
      color: #a0a0a0;
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 2px;
    }
    
    /* ä¼˜åŒ–"ä¸‹ä¸€å±€"æŒ‰é’®æ ·å¼ - å±…ä¸­æ˜¾ç¤º */
    .next-round-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 15px 30px;
      font-size: 18px;
      border-radius: 25px;
      font-weight: bold;
      color: white;
      text-align: center;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 1px;
      min-width: 120px;
    }
    
    .next-round-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }
  </style>
</head>
<body>
  <div class="background" id="background"></div>
  
  <!-- è‡ªå®šä¹‰å¼¹çª— -->
  <div class="custom-modal" id="customModal">
    <div class="modal-content">
      <div class="modal-title" id="modalTitle">ç¡®è®¤æ“ä½œ</div>
      <div class="modal-message" id="modalMessage">æ‚¨ç¡®å®šè¦æ‰§è¡Œæ­¤æ“ä½œå—ï¼Ÿ</div>
      <div class="modal-buttons">
        <button class="modal-btn confirm" id="modalConfirm">ç¡®è®¤</button>
        <button class="modal-btn cancel" id="modalCancel">å–æ¶ˆ</button>
      </div>
    </div>
  </div>
  
  <div class="game-container">
    <!-- é¡¶éƒ¨åŒºåŸŸï¼šæ–°æ¸¸æˆæŒ‰é’®å’Œæ¸¸æˆä¿¡æ¯ -->
    <div class="top-area">
      <button class="top-new-game-btn" id="newGameBtn">æ–°æ¸¸æˆ</button>
      
      <!-- æ¸¸æˆä¿¡æ¯ -->
      <div class="game-info">
        <div class="info-box">
          <div class="info-title">ç©å®¶ç­¹ç </div>
          <div class="info-value" id="playerChips">1000</div>
        </div>
        
        <div class="info-box">
          <div class="info-title">åº•æ± </div>
          <div class="info-value" id="pot">0</div>
        </div>
        
        <div class="info-box">
          <div class="info-title">AIç­¹ç </div>
          <div class="info-value" id="aiChips">1000</div>
        </div>
      </div>
    </div>
    
    <!-- æ¸¸æˆçŠ¶æ€ -->
    <div class="game-status" id="gameStatus">ç‚¹å‡»æ–°æ¸¸æˆå¼€å§‹</div>
    
    <!-- AIåŒºåŸŸ -->
    <div class="ai-area">
      <div class="ai-label">AI å¯¹æ‰‹</div>
      <div class="ai-cards" id="aiCards">
        <div class="card hidden"></div>
        <div class="card hidden"></div>
      </div>
      <div class="hand-strength" id="aiHandStrength"></div>
    </div>
    
    <!-- å…¬å…±ç‰ŒåŒºåŸŸ -->
    <div class="community-area">
      <div class="community-label">å…¬å…±ç‰Œ</div>
      <div class="community-cards" id="communityCards">
        <div class="card hidden"></div>
        <div class="card hidden"></div>
        <div class="card hidden"></div>
        <div class="card hidden"></div>
        <div class="card hidden"></div>
      </div>
    </div>
    
    <!-- ç©å®¶åŒºåŸŸ -->
    <div class="player-area">
      <div class="player-label">ç©å®¶</div>
      <div class="player-cards" id="playerCards">
        <div class="card hidden"></div>
        <div class="card hidden"></div>
      </div>
      <div class="hand-strength" id="playerHandStrength"></div>
    </div>
    
    <!-- æ“ä½œæŒ‰é’® -->
    <div class="action-buttons">
      <button class="action-btn fold-btn" id="foldBtn" disabled>å¼ƒç‰Œ</button>
      <button class="action-btn check-btn" id="checkBtn" disabled>è¿‡ç‰Œ</button>
      <button class="action-btn call-btn" id="callBtn" disabled>è·Ÿæ³¨</button>
      <button class="action-btn raise-btn" id="raiseBtn" disabled>åŠ æ³¨</button>
    </div>
  </div>
  
  <!-- è·èƒœè€…å…¬å‘Š -->
  <div class="winner-announcement" id="winnerAnnouncement">
    <div class="winner-text" id="winnerText"></div>
    <div class="winner-details" id="winnerDetails"></div>
    
    <!-- ç‰Œé¢å±•ç¤ºåŒºåŸŸ -->
    <div class="winner-cards-container" id="winnerCardsContainer">
      <!-- AIç‰Œé¢ -->
      <div class="winner-player-section">
        <div class="winner-player-label ai">AI å¯¹æ‰‹</div>
        <div class="winner-cards-row" id="winnerAiCards"></div>
        <div class="winner-hand-strength" id="winnerAiHandStrength"></div>
      </div>
      
      <!-- å…¬å…±ç‰Œ -->
      <div class="winner-community-section">
        <div class="winner-community-label">å…¬å…±ç‰Œ</div>
        <div class="winner-cards-row" id="winnerCommunityCards"></div>
      </div>
      
      <!-- ç©å®¶ç‰Œé¢ -->
      <div class="winner-player-section">
        <div class="winner-player-label">ç©å®¶</div>
        <div class="winner-cards-row" id="winnerPlayerCards"></div>
        <div class="winner-hand-strength" id="winnerPlayerHandStrength"></div>
      </div>
    </div>
    
    <button class="next-round-btn" id="nextRoundBtn">ä¸‹ä¸€å±€</button>
  </div>

  <script>
    // æ¸¸æˆçŠ¶æ€
    let gameState = {
      deck: [],
      playerCards: [],
      aiCards: [],
      communityCards: [],
      playerChips: 1000,
      aiChips: 1000,
      pot: 0,
      currentBet: 0,
      playerBet: 0,
      aiBet: 0,
      gamePhase: 'preflop', // preflop, flop, turn, river, showdown
      gameActive: false,
      playerTurn: true,
      isFirstGame: true // æ–°å¢ï¼šæ ‡è®°æ˜¯å¦ä¸ºé¦–æ¬¡æ¸¸æˆ
    };
    
    // æ‰‘å…‹ç‰Œå®šä¹‰
    const suits = ['â™ ', 'â™¥', 'â™¦', 'â™£'];
    const ranks = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
    const rankValues = {
      '2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, '9': 9, '10': 10,
      'J': 11, 'Q': 12, 'K': 13, 'A': 14
    };
    
    // æ‰‹ç‰Œå¼ºåº¦åç§°
    const handNames = {
      'high-card': 'é«˜ç‰Œ',
      'pair': 'ä¸€å¯¹',
      'two-pair': 'ä¸¤å¯¹',
      'three-of-a-kind': 'ä¸‰æ¡',
      'straight': 'é¡ºå­',
      'flush': 'åŒèŠ±',
      'full-house': 'è‘«èŠ¦',
      'four-of-a-kind': 'å››æ¡',
      'straight-flush': 'åŒèŠ±é¡º',
      'royal-flush': 'çš‡å®¶åŒèŠ±é¡º'
    };
    
    // å¼¹çª—ç›¸å…³å˜é‡
    let modalCallback = null;
    
    // æ€§èƒ½ä¼˜åŒ–ï¼šç¼“å­˜DOMå…ƒç´ 
    const domCache = {
      playerChips: null,
      aiChips: null,
      pot: null,
      gameStatus: null,
      playerCards: null,
      aiCards: null,
      communityCards: null,
      playerHandStrength: null,
      aiHandStrength: null,
      foldBtn: null,
      checkBtn: null,
      callBtn: null,
      raiseBtn: null
    };
    
    // åˆå§‹åŒ–æ¸¸æˆ
    function init() {
      // ç¼“å­˜DOMå…ƒç´ ä»¥æé«˜æ€§èƒ½
      domCache.playerChips = document.getElementById('playerChips');
      domCache.aiChips = document.getElementById('aiChips');
      domCache.pot = document.getElementById('pot');
      domCache.gameStatus = document.getElementById('gameStatus');
      domCache.playerCards = document.getElementById('playerCards');
      domCache.aiCards = document.getElementById('aiCards');
      domCache.communityCards = document.getElementById('communityCards');
      domCache.playerHandStrength = document.getElementById('playerHandStrength');
      domCache.aiHandStrength = document.getElementById('aiHandStrength');
      domCache.foldBtn = document.getElementById('foldBtn');
      domCache.checkBtn = document.getElementById('checkBtn');
      domCache.callBtn = document.getElementById('callBtn');
      domCache.raiseBtn = document.getElementById('raiseBtn');
      
      createBackground();
      setupEventListeners();
      updateDisplay();
    }
    
    // åˆ›å»ºåŠ¨æ€èƒŒæ™¯
    function createBackground() {
      const bg = document.getElementById('background');
      const colors = ['rgba(255,255,255,0.05)', 'rgba(255,255,255,0.03)', 'rgba(255,255,255,0.02)'];
      
      for (let i = 0; i < 15; i++) {
        const shape = document.createElement('div');
        shape.classList.add('shape');
        
        const size = Math.random() * 80 + 40;
        shape.style.width = `${size}px`;
        shape.style.height = `${size}px`;
        shape.style.left = `${Math.random() * 100}%`;
        shape.style.top = `${Math.random() * 100}%`;
        shape.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        shape.style.animationDuration = `${Math.random() * 25 + 20}s`;
        shape.style.animationDelay = `${Math.random() * 5}s`;
        
        bg.appendChild(shape);
      }
    }
    
    // æ˜¾ç¤ºè‡ªå®šä¹‰å¼¹çª—
    function showCustomModal(title, message, onConfirm) {
      document.getElementById('modalTitle').textContent = title;
      document.getElementById('modalMessage').textContent = message;
      document.getElementById('customModal').style.display = 'flex';
      modalCallback = onConfirm;
    }
    
    // éšè—è‡ªå®šä¹‰å¼¹çª—
    function hideCustomModal() {
      document.getElementById('customModal').style.display = 'none';
      modalCallback = null;
    }
    
    // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
    function setupEventListeners() {
      document.getElementById('newGameBtn').addEventListener('click', () => {
        // é¦–æ¬¡ç‚¹å‡»ä¸å¼¹çª—ï¼Œç›´æ¥å¼€å§‹æ¸¸æˆ
        if (gameState.isFirstGame) {
          gameState.isFirstGame = false;
          startNewGame();
        } else {
          // éé¦–æ¬¡ç‚¹å‡»æ‰å¼¹çª—ç¡®è®¤
          showCustomModal(
            'å¼€å§‹æ–°æ¸¸æˆ',
            'ç¡®å®šè¦å¼€å§‹æ–°æ¸¸æˆå—ï¼Ÿå½“å‰è¿›åº¦å°†ä¼šä¸¢å¤±ã€‚',
            () => {
              hideCustomModal();
              startNewGame();
            }
          );
        }
      });
      
      document.getElementById('foldBtn').addEventListener('click', () => {
        showCustomModal(
          'ç¡®è®¤å¼ƒç‰Œ',
          'ç¡®å®šè¦å¼ƒç‰Œå—ï¼Ÿæ‚¨å°†å¤±å»æœ¬è½®çš„æ‰€æœ‰ç­¹ç ã€‚',
          () => {
            hideCustomModal();
            playerAction('fold');
          }
        );
      });
      
      document.getElementById('checkBtn').addEventListener('click', () => playerAction('check'));
      document.getElementById('callBtn').addEventListener('click', () => playerAction('call'));
      document.getElementById('raiseBtn').addEventListener('click', () => playerAction('raise'));
      document.getElementById('nextRoundBtn').addEventListener('click', startNewRound);
      
      // å¼¹çª—æŒ‰é’®äº‹ä»¶
      document.getElementById('modalConfirm').addEventListener('click', () => {
        if (modalCallback) {
          modalCallback();
        }
      });
      
      document.getElementById('modalCancel').addEventListener('click', hideCustomModal);
      
      // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
      document.getElementById('customModal').addEventListener('click', (e) => {
        if (e.target === document.getElementById('customModal')) {
          hideCustomModal();
        }
      });
    }
    
    // åˆ›å»ºæ–°ç‰Œç»„
    function createDeck() {
      const deck = [];
      for (let suit of suits) {
        for (let rank of ranks) {
          deck.push({ suit, rank, color: (suit === 'â™¥' || suit === 'â™¦') ? 'red' : 'black' });
        }
      }
      return shuffleDeck(deck);
    }
    
    // æ´—ç‰Œ
    function shuffleDeck(deck) {
      for (let i = deck.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [deck[i], deck[j]] = [deck[j], deck[i]];
      }
      return deck;
    }
    
    // å¼€å§‹æ–°æ¸¸æˆ
    function startNewGame() {
      gameState = {
        ...gameState, // ä¿ç•™ isFirstGame çŠ¶æ€
        deck: createDeck(),
        playerCards: [],
        aiCards: [],
        communityCards: [],
        playerChips: 1000,
        aiChips: 1000,
        pot: 0,
        currentBet: 0,
        playerBet: 0,
        aiBet: 0,
        gamePhase: 'preflop',
        gameActive: true,
        playerTurn: true
      };
      
      startNewRound();
    }
    
    // å¼€å§‹æ–°ä¸€è½®
    function startNewRound() {
      if (gameState.playerChips <= 0) {
        showWinner('AIè·èƒœï¼', 'ä½ çš„ç­¹ç ç”¨å®Œäº†ï¼');
        return;
      }
      
      if (gameState.aiChips <= 0) {
        showWinner('ç©å®¶è·èƒœï¼', 'AIçš„ç­¹ç ç”¨å®Œäº†ï¼');
        return;
      }
      
      // é‡ç½®è½®æ¬¡çŠ¶æ€
      gameState.deck = createDeck();
      gameState.playerCards = [];
      gameState.aiCards = [];
      gameState.communityCards = [];
      gameState.pot = 0;
      gameState.currentBet = 10; // å°ç›²æ³¨
      gameState.playerBet = 5; // å°ç›²æ³¨
      gameState.aiBet = 10; // å¤§ç›²æ³¨
      gameState.gamePhase = 'preflop';
      gameState.gameActive = true;
      gameState.playerTurn = true;
      
      // æ‰£é™¤ç›²æ³¨
      gameState.playerChips -= 5;
      gameState.aiChips -= 10;
      gameState.pot = 15;
      
      // å‘ç‰Œ
      dealCards();
      updateDisplay();
      updateGameStatus('ä½ çš„å›åˆ - é€‰æ‹©è¡ŒåŠ¨');
      
      document.getElementById('winnerAnnouncement').style.display = 'none';
    }
    
    // å‘ç‰Œ
    function dealCards() {
      // ç»™ç©å®¶å’ŒAIå„å‘ä¸¤å¼ ç‰Œ
      for (let i = 0; i < 2; i++) {
        gameState.playerCards.push(gameState.deck.pop());
        gameState.aiCards.push(gameState.deck.pop());
      }
    }
    
    // ç©å®¶è¡ŒåŠ¨
    function playerAction(action) {
      if (!gameState.gameActive || !gameState.playerTurn) return;
      
      switch (action) {
        case 'fold':
          gameState.aiChips += gameState.pot;
          showWinner('AIè·èƒœï¼', 'ä½ å¼ƒç‰Œäº†');
          return;
          
        case 'check':
          if (gameState.playerBet === gameState.aiBet) {
            gameState.playerTurn = false;
            setTimeout(() => aiAction(), 1000);
          }
          break;
          
        case 'call':
          const callAmount = gameState.aiBet - gameState.playerBet;
          if (gameState.playerChips >= callAmount) {
            gameState.playerChips -= callAmount;
            gameState.playerBet += callAmount;
            gameState.pot += callAmount;
            gameState.playerTurn = false;
            setTimeout(() => aiAction(), 1000);
          }
          break;
          
        case 'raise':
          const raiseAmount = 20;
          const totalAmount = gameState.aiBet - gameState.playerBet + raiseAmount;
          if (gameState.playerChips >= totalAmount) {
            gameState.playerChips -= totalAmount;
            gameState.playerBet += totalAmount;
            gameState.pot += totalAmount;
            gameState.currentBet = gameState.playerBet;
            gameState.playerTurn = false;
            setTimeout(() => aiAction(), 1000);
          }
          break;
      }
      
      updateDisplay();
    }
    
    // AIè¡ŒåŠ¨ - æå¤§é™ä½å¼ƒç‰Œæ¦‚ç‡çš„è¶…æ¿€è¿›ç®—æ³•
    function aiAction() {
      if (!gameState.gameActive) return;
      
      const aiHandStrength = evaluateHand([...gameState.aiCards, ...gameState.communityCards]);
      const random = Math.random();
      
      // è®¡ç®—å½“å‰åº•æ± èµ”ç‡å’Œæ‰€éœ€è·Ÿæ³¨é‡‘é¢
      const callAmount = gameState.playerBet - gameState.aiBet;
      const potOdds = callAmount > 0 ? gameState.pot / callAmount : 0;
      
      // è¯„ä¼°èµ·æ‰‹ç‰Œè´¨é‡ï¼ˆä»…åœ¨preflopé˜¶æ®µï¼‰
      let preflopStrength = 0;
      if (gameState.gamePhase === 'preflop') {
        preflopStrength = evaluatePreflopHand(gameState.aiCards);
      }
      
      // æ ¹æ®æ¸¸æˆé˜¶æ®µè°ƒæ•´ç­–ç•¥
      let aggressionLevel = getAggressionLevel(gameState.gamePhase, aiHandStrength, preflopStrength);
      
      if (gameState.playerBet > gameState.aiBet) {
        // éœ€è¦è·Ÿæ³¨çš„æƒ…å†µ - æå¤§é™ä½å¼ƒç‰Œæ¦‚ç‡ï¼ŒAIå‡ ä¹ä¸å¼ƒç‰Œ
        let shouldCall = false;
        
        if (gameState.gamePhase === 'preflop') {
          // Preflopé˜¶æ®µï¼šåŸºäºèµ·æ‰‹ç‰Œè´¨é‡å†³ç­– - æé«˜è·Ÿæ³¨æ¦‚ç‡
          if (preflopStrength >= 8 || // é¡¶çº§èµ·æ‰‹ç‰Œï¼ˆAA, KK, QQ, AKç­‰ï¼‰
              (preflopStrength >= 6 && random < 0.99) || // å¼ºèµ·æ‰‹ç‰Œï¼Œ99%è·Ÿæ³¨
              (preflopStrength >= 4 && random < 0.95) || // ä¸­ç­‰èµ·æ‰‹ç‰Œï¼Œ95%è·Ÿæ³¨
              (preflopStrength >= 2 && random < 0.9) || // å¼±èµ·æ‰‹ç‰Œï¼Œ90%è·Ÿæ³¨
              (preflopStrength >= 1 && random < 0.85) || // å¾ˆå¼±èµ·æ‰‹ç‰Œï¼Œ85%è·Ÿæ³¨
              (potOdds > 1.5 && random < 0.8) || // åº•æ± èµ”ç‡ä¸€èˆ¬ï¼Œ80%è·Ÿæ³¨
              random < 0.75) { // å³ä½¿å¾ˆå·®çš„ç‰Œä¹Ÿæœ‰75%æ¦‚ç‡è·Ÿæ³¨
            shouldCall = true;
          }
        } else {
          // Flopåé˜¶æ®µï¼šåŸºäºå®é™…ç‰ŒåŠ›å†³ç­– - æé«˜è·Ÿæ³¨æ¦‚ç‡
          if (aiHandStrength.rank >= 6 || // è‘«èŠ¦åŠä»¥ä¸Š
              (aiHandStrength.rank >= 4 && random < 0.99) || // é¡ºå­/åŒèŠ±ï¼Œ99%è·Ÿæ³¨
              (aiHandStrength.rank >= 2 && random < 0.95) || // ä¸¤å¯¹åŠä»¥ä¸Šï¼Œ95%è·Ÿæ³¨
              (aiHandStrength.rank >= 1 && random < 0.9) || // ä¸€å¯¹ï¼Œ90%è·Ÿæ³¨
              (aiHandStrength.rank === 0 && potOdds > 2 && random < 0.8) || // é«˜ç‰Œä½†åº•æ± èµ”ç‡å¥½ï¼Œ80%è·Ÿæ³¨
              (aiHandStrength.rank === 0 && random < 0.7)) { // é«˜ç‰Œï¼Œ70%è·Ÿæ³¨
            shouldCall = true;
          }
        }
        
        if (shouldCall) {
          if (gameState.aiChips >= callAmount) {
            gameState.aiChips -= callAmount;
            gameState.aiBet += callAmount;
            gameState.pot += callAmount;
            updateGameStatus('AIè·Ÿæ³¨äº†');
            
            // è·Ÿæ³¨åè€ƒè™‘æ˜¯å¦ååŠ æ³¨
            if (aggressionLevel > 6 && random < 0.4 && gameState.aiChips >= 20) {
              setTimeout(() => {
                const raiseAmount = Math.min(20, gameState.aiChips);
                gameState.aiChips -= raiseAmount;
                gameState.aiBet += raiseAmount;
                gameState.pot += raiseAmount;
                gameState.currentBet = gameState.aiBet;
                updateGameStatus('AIååŠ æ³¨äº†ï¼ä½ çš„å›åˆ');
                gameState.playerTurn = true;
                updateDisplay();
              }, 500);
              return;
            }
          } else {
            // ç­¹ç ä¸å¤Ÿè·Ÿæ³¨ï¼Œå…¨æŠ¼
            gameState.pot += gameState.aiChips;
            gameState.aiBet += gameState.aiChips;
            gameState.aiChips = 0;
            updateGameStatus('AIå…¨æŠ¼äº†ï¼');
          }
        } else {
          // æå°‘æ•°æƒ…å†µä¸‹å¼ƒç‰Œ
          gameState.playerChips += gameState.pot;
          showWinner('ç©å®¶è·èƒœï¼', 'AIå¼ƒç‰Œäº†');
          return;
        }
      } else {
        // ä¸éœ€è¦è·Ÿæ³¨çš„æƒ…å†µï¼Œè€ƒè™‘åŠ æ³¨æˆ–è¿‡ç‰Œ
        let raiseChance = 0;
        
        if (gameState.gamePhase === 'preflop') {
          // PreflopåŠ æ³¨ç­–ç•¥ - æé«˜åŠ æ³¨æ¦‚ç‡
          if (preflopStrength >= 9) raiseChance = 0.98; // é¡¶çº§ç‰Œ98%åŠ æ³¨
          else if (preflopStrength >= 7) raiseChance = 0.85; // å¼ºç‰Œ85%åŠ æ³¨
          else if (preflopStrength >= 5) raiseChance = 0.6; // ä¸­ç­‰ç‰Œ60%åŠ æ³¨
          else if (preflopStrength >= 3) raiseChance = 0.4; // å¼±ç‰Œ40%åŠ æ³¨ï¼ˆè™šå¼ å£°åŠ¿ï¼‰
          else raiseChance = 0.3; // å¾ˆå¼±ç‰Œ30%åŠ æ³¨ï¼ˆè™šå¼ å£°åŠ¿ï¼‰
        } else {
          // FlopååŠ æ³¨ç­–ç•¥ - æé«˜åŠ æ³¨æ¦‚ç‡
          if (aiHandStrength.rank >= 7) raiseChance = 0.99; // å››æ¡åŠä»¥ä¸Š99%åŠ æ³¨
          else if (aiHandStrength.rank >= 5) raiseChance = 0.9; // åŒèŠ±åŠä»¥ä¸Š90%åŠ æ³¨
          else if (aiHandStrength.rank >= 3) raiseChance = 0.75; // ä¸‰æ¡åŠä»¥ä¸Š75%åŠ æ³¨
          else if (aiHandStrength.rank >= 2) raiseChance = 0.6; // ä¸¤å¯¹60%åŠ æ³¨
          else if (aiHandStrength.rank >= 1) raiseChance = 0.4; // ä¸€å¯¹40%åŠ æ³¨
          else raiseChance = 0.3; // é«˜ç‰Œ30%åŠ æ³¨ï¼ˆè™šå¼ å£°åŠ¿ï¼‰
        }
        
        if (random < raiseChance) {
          const raiseAmount = Math.min(20 + Math.floor(aggressionLevel * 5), gameState.aiChips);
          if (gameState.aiChips >= raiseAmount) {
            gameState.aiChips -= raiseAmount;
            gameState.aiBet += raiseAmount;
            gameState.pot += raiseAmount;
            gameState.currentBet = gameState.aiBet;
            updateGameStatus('AIåŠ æ³¨äº†ï¼ä½ çš„å›åˆ');
            gameState.playerTurn = true;
            updateDisplay();
            return;
          }
        }
        updateGameStatus('AIè¿‡ç‰Œ');
      }
      
      // è¿›å…¥ä¸‹ä¸€é˜¶æ®µ
      nextPhase();
    }
    
    // è¯„ä¼°èµ·æ‰‹ç‰Œè´¨é‡ï¼ˆpreflopä¸“ç”¨ï¼‰
    function evaluatePreflopHand(cards) {
      if (cards.length !== 2) return 0;
      
      const card1 = cards[0];
      const card2 = cards[1];
      const rank1 = rankValues[card1.rank];
      const rank2 = rankValues[card2.rank];
      const suited = card1.suit === card2.suit;
      const gap = Math.abs(rank1 - rank2);
      
      let strength = 0;
      
      // å¯¹å­
      if (rank1 === rank2) {
        if (rank1 >= 14) strength = 10; // AA
        else if (rank1 >= 13) strength = 9; // KK
        else if (rank1 >= 12) strength = 8; // QQ
        else if (rank1 >= 11) strength = 7; // JJ
        else if (rank1 >= 10) strength = 6; // TT
        else if (rank1 >= 8) strength = 5; // 88-99
        else if (rank1 >= 6) strength = 4; // 66-77
        else strength = 3; // 22-55
      } else {
        // éå¯¹å­
        const highCard = Math.max(rank1, rank2);
        const lowCard = Math.min(rank1, rank2);
        
        // AK, AQ, AJç­‰
        if (highCard === 14) {
          if (lowCard >= 13) strength = suited ? 9 : 8; // AK
          else if (lowCard >= 12) strength = suited ? 8 : 7; // AQ
          else if (lowCard >= 11) strength = suited ? 7 : 6; // AJ
          else if (lowCard >= 10) strength = suited ? 6 : 5; // AT
          else if (lowCard >= 8) strength = suited ? 5 : 4; // A8-A9
          else strength = suited ? 4 : 2; // A2-A7
        }
        // KQ, KJç­‰
        else if (highCard === 13) {
          if (lowCard >= 12) strength = suited ? 7 : 6; // KQ
          else if (lowCard >= 11) strength = suited ? 6 : 5; // KJ
          else if (lowCard >= 10) strength = suited ? 5 : 4; // KT
          else strength = suited ? 3 : 2; // K2-K9
        }
        // QJ, QTç­‰
        else if (highCard === 12) {
          if (lowCard >= 11) strength = suited ? 6 : 5; // QJ
          else if (lowCard >= 10) strength = suited ? 5 : 4; // QT
          else strength = suited ? 3 : 2; // Q2-Q9
        }
        // JTç­‰
        else if (highCard === 11 && lowCard >= 10) {
          strength = suited ? 5 : 4; // JT
        }
        // è¿ç‰Œ
        else if (gap === 1 && highCard >= 8) {
          strength = suited ? 4 : 3; // è¿ç‰Œ
        }
        // åŒèŠ±ç‰Œ
        else if (suited && highCard >= 10) {
          strength = 3;
        }
        // å…¶ä»–
        else {
          strength = suited ? 2 : 1;
        }
      }
      
      return strength;
    }
    
    // è·å–æ¿€è¿›ç¨‹åº¦
    function getAggressionLevel(phase, handStrength, preflopStrength) {
      let level = 5; // åŸºç¡€æ¿€è¿›ç¨‹åº¦
      
      if (phase === 'preflop') {
        level = Math.max(1, preflopStrength);
      } else {
        level = Math.max(1, handStrength.rank + 2);
      }
      
      // æ ¹æ®ç­¹ç æ¯”ä¾‹è°ƒæ•´
      const chipRatio = gameState.aiChips / (gameState.aiChips + gameState.playerChips);
      if (chipRatio < 0.3) level += 2; // ç­¹ç å°‘æ—¶æ›´æ¿€è¿›
      else if (chipRatio > 0.7) level += 1; // ç­¹ç å¤šæ—¶ç¨å¾®æ¿€è¿›
      
      return Math.min(10, level);
    }
    
    // è¿›å…¥ä¸‹ä¸€é˜¶æ®µ
    function nextPhase() {
      if (gameState.gamePhase === 'preflop') {
        gameState.gamePhase = 'flop';
        dealFlop();
      } else if (gameState.gamePhase === 'flop') {
        gameState.gamePhase = 'turn';
        dealTurn();
      } else if (gameState.gamePhase === 'turn') {
        gameState.gamePhase = 'river';
        dealRiver();
      } else if (gameState.gamePhase === 'river') {
        gameState.gamePhase = 'showdown';
        showdown();
        return;
      }
      
      // é‡ç½®ä¸‹æ³¨
      gameState.playerBet = 0;
      gameState.aiBet = 0;
      gameState.currentBet = 0;
      gameState.playerTurn = true;
      
      updateDisplay();
      updateGameStatus('ä½ çš„å›åˆ - é€‰æ‹©è¡ŒåŠ¨');
    }
    
    // å‘ç¿»ç‰Œ
    function dealFlop() {
      gameState.deck.pop(); // çƒ§ç‰Œ
      for (let i = 0; i < 3; i++) {
        gameState.communityCards.push(gameState.deck.pop());
      }
      
      // æ·»åŠ ç¿»ç‰ŒåŠ¨ç”»
      const communityCards = domCache.communityCards.children;
      for (let i = 0; i < 3; i++) {
        setTimeout(() => {
          communityCards[i].classList.add('flipping');
          setTimeout(() => {
            communityCards[i].classList.remove('flipping');
          }, 600);
        }, i * 200);
      }
    }
    
    // å‘è½¬ç‰Œ
    function dealTurn() {
      gameState.deck.pop(); // çƒ§ç‰Œ
      gameState.communityCards.push(gameState.deck.pop());
      
      // æ·»åŠ è½¬ç‰ŒåŠ¨ç”»
      const turnCard = domCache.communityCards.children[3];
      turnCard.classList.add('flipping');
      setTimeout(() => {
        turnCard.classList.remove('flipping');
      }, 600);
    }
    
    // å‘æ²³ç‰Œ
    function dealRiver() {
      gameState.deck.pop(); // çƒ§ç‰Œ
      gameState.communityCards.push(gameState.deck.pop());
      
      // æ·»åŠ æ²³ç‰ŒåŠ¨ç”»
      const riverCard = domCache.communityCards.children[4];
      riverCard.classList.add('flipping');
      setTimeout(() => {
        riverCard.classList.remove('flipping');
      }, 600);
    }
    
    // æ‘Šç‰Œ
    function showdown() {
      const playerHand = evaluateHand([...gameState.playerCards, ...gameState.communityCards]);
      const aiHand = evaluateHand([...gameState.aiCards, ...gameState.communityCards]);
      
      let winner = '';
      let details = '';
      
      if (playerHand.rank > aiHand.rank || 
          (playerHand.rank === aiHand.rank && playerHand.tiebreaker > aiHand.tiebreaker)) {
        winner = 'ç©å®¶è·èƒœï¼';
        details = `ç©å®¶: ${handNames[playerHand.type]} vs AI: ${handNames[aiHand.type]}`;
        gameState.playerChips += gameState.pot;
      } else if (aiHand.rank > playerHand.rank || 
                 (aiHand.rank === playerHand.rank && aiHand.tiebreaker > playerHand.tiebreaker)) {
        winner = 'AIè·èƒœï¼';
        details = `AI: ${handNames[aiHand.type]} vs ç©å®¶: ${handNames[playerHand.type]}`;
        gameState.aiChips += gameState.pot;
      } else {
        winner = 'å¹³å±€ï¼';
        details = `åŒæ–¹éƒ½æ˜¯: ${handNames[playerHand.type]}`;
        gameState.playerChips += Math.floor(gameState.pot / 2);
        gameState.aiChips += Math.ceil(gameState.pot / 2);
      }
      
      showWinner(winner, details);
    }
    
    // æ˜¾ç¤ºè·èƒœè€…
    function showWinner(winner, details) {
      document.getElementById('winnerText').textContent = winner;
      document.getElementById('winnerDetails').textContent = details;
      
      // æ˜¾ç¤ºç‰Œé¢
      showWinnerCards();
      
      document.getElementById('winnerAnnouncement').style.display = 'flex';
      gameState.gameActive = false;
      
      // æ˜¾ç¤ºAIçš„ç‰Œ
      updateDisplay(true);
    }
    
    // æ˜¾ç¤ºå®Œç»“å¼¹çª—ä¸­çš„ç‰Œé¢
    function showWinnerCards() {
      // æ˜¾ç¤ºAIæ‰‹ç‰Œ
      const aiCardsContainer = document.getElementById('winnerAiCards');
      aiCardsContainer.innerHTML = '';
      gameState.aiCards.forEach(card => {
        const cardElement = createWinnerCardElement(card);
        aiCardsContainer.appendChild(cardElement);
      });
      
      // æ˜¾ç¤ºç©å®¶æ‰‹ç‰Œ
      const playerCardsContainer = document.getElementById('winnerPlayerCards');
      playerCardsContainer.innerHTML = '';
      gameState.playerCards.forEach(card => {
        const cardElement = createWinnerCardElement(card);
        playerCardsContainer.appendChild(cardElement);
      });
      
      // æ˜¾ç¤ºå…¬å…±ç‰Œ
      const communityCardsContainer = document.getElementById('winnerCommunityCards');
      communityCardsContainer.innerHTML = '';
      gameState.communityCards.forEach(card => {
        const cardElement = createWinnerCardElement(card);
        communityCardsContainer.appendChild(cardElement);
      });
      
      // æ˜¾ç¤ºæ‰‹ç‰Œå¼ºåº¦
      if (gameState.playerCards.length > 0) {
        const playerHand = evaluateHand([...gameState.playerCards, ...gameState.communityCards]);
        document.getElementById('winnerPlayerHandStrength').textContent = handNames[playerHand.type];
      }
      
      if (gameState.aiCards.length > 0) {
        const aiHand = evaluateHand([...gameState.aiCards, ...gameState.communityCards]);
        document.getElementById('winnerAiHandStrength').textContent = handNames[aiHand.type];
      }
    }
    
    // åˆ›å»ºå®Œç»“å¼¹çª—ä¸­çš„ç‰Œé¢å…ƒç´ 
    function createWinnerCardElement(card) {
      const cardElement = document.createElement('div');
      cardElement.className = `winner-card ${card.color}`;
      cardElement.innerHTML = `
        <div class="winner-card-rank">${card.rank}</div>
        <div class="winner-card-suit">${card.suit}</div>
      `;
      return cardElement;
    }
    
    // æ›´æ–°æ˜¾ç¤º
    function updateDisplay(showAiCards = false) {
      // ä½¿ç”¨ç¼“å­˜çš„DOMå…ƒç´ æé«˜æ€§èƒ½
      domCache.playerChips.textContent = gameState.playerChips;
      domCache.aiChips.textContent = gameState.aiChips;
      domCache.pot.textContent = gameState.pot;
      
      // æ›´æ–°ç©å®¶æ‰‹ç‰Œ
      updateCards(domCache.playerCards, gameState.playerCards, false);
      
      // æ›´æ–°AIæ‰‹ç‰Œ
      updateCards(domCache.aiCards, gameState.aiCards, !showAiCards);
      
      // æ›´æ–°å…¬å…±ç‰Œ
      updateCards(domCache.communityCards, gameState.communityCards, false);
      
      // æ›´æ–°æ‰‹ç‰Œå¼ºåº¦
      if (gameState.playerCards.length > 0) {
        const playerHand = evaluateHand([...gameState.playerCards, ...gameState.communityCards]);
        domCache.playerHandStrength.textContent = handNames[playerHand.type];
      }
      
      if (showAiCards && gameState.aiCards.length > 0) {
        const aiHand = evaluateHand([...gameState.aiCards, ...gameState.communityCards]);
        domCache.aiHandStrength.textContent = handNames[aiHand.type];
      } else {
        domCache.aiHandStrength.textContent = '';
      }
      
      // æ›´æ–°æŒ‰é’®çŠ¶æ€
      updateButtons();
    }
    
    // æ›´æ–°å¡ç‰Œæ˜¾ç¤º
    function updateCards(container, cards, hidden) {
      const cardElements = container.children;
      
      for (let i = 0; i < cardElements.length; i++) {
        const cardElement = cardElements[i];
        
        if (i < cards.length && !hidden) {
          const card = cards[i];
          cardElement.className = `card ${card.color}`;
          cardElement.innerHTML = `
            <div class="card-rank">${card.rank}</div>
            <div class="card-suit">${card.suit}</div>
          `;
        } else {
          cardElement.className = 'card hidden';
          cardElement.innerHTML = '';
        }
      }
    }
    
    // æ›´æ–°æŒ‰é’®çŠ¶æ€
    function updateButtons() {
      const isPlayerTurn = gameState.gameActive && gameState.playerTurn;
      const needToCall = gameState.playerBet < gameState.aiBet;
      
      domCache.foldBtn.disabled = !isPlayerTurn;
      domCache.checkBtn.disabled = !isPlayerTurn || needToCall;
      domCache.callBtn.disabled = !isPlayerTurn || !needToCall;
      domCache.raiseBtn.disabled = !isPlayerTurn || gameState.playerChips < 20;
      
      if (needToCall) {
        const callAmount = gameState.aiBet - gameState.playerBet;
        domCache.callBtn.textContent = `è·Ÿæ³¨ ${callAmount}`;
      } else {
        domCache.callBtn.textContent = 'è·Ÿæ³¨';
      }
    }
    
    // æ›´æ–°æ¸¸æˆçŠ¶æ€
    function updateGameStatus(status) {
      domCache.gameStatus.textContent = status;
    }
    
    // è¯„ä¼°æ‰‹ç‰Œ
    function evaluateHand(cards) {
      if (cards.length < 5) return { rank: 0, type: 'high-card', tiebreaker: 0 };
      
      // è·å–æ‰€æœ‰å¯èƒ½çš„5å¼ ç‰Œç»„åˆ
      const combinations = getCombinations(cards, 5);
      let bestHand = { rank: 0, type: 'high-card', tiebreaker: 0 };
      
      for (let combo of combinations) {
        const hand = evaluateFiveCards(combo);
        if (hand.rank > bestHand.rank || 
            (hand.rank === bestHand.rank && hand.tiebreaker > bestHand.tiebreaker)) {
          bestHand = hand;
        }
      }
      
      return bestHand;
    }
    
    // è¯„ä¼°5å¼ ç‰Œ
    function evaluateFiveCards(cards) {
      const ranks = cards.map(card => rankValues[card.rank]).sort((a, b) => b - a);
      const suits = cards.map(card => card.suit);
      
      const isFlush = suits.every(suit => suit === suits[0]);
      const isStraight = checkStraight(ranks);
      
      const rankCounts = {};
      ranks.forEach(rank => {
        rankCounts[rank] = (rankCounts[rank] || 0) + 1;
      });
      
      const counts = Object.values(rankCounts).sort((a, b) => b - a);
      const uniqueRanks = Object.keys(rankCounts).map(Number).sort((a, b) => b - a);
      
      // çš‡å®¶åŒèŠ±é¡º
      if (isFlush && isStraight && ranks[0] === 14) {
        return { rank: 9, type: 'royal-flush', tiebreaker: 0 };
      }
      
      // åŒèŠ±é¡º
      if (isFlush && isStraight) {
        return { rank: 8, type: 'straight-flush', tiebreaker: ranks[0] };
      }
      
      // å››æ¡
      if (counts[0] === 4) {
        const fourKind = uniqueRanks.find(rank => rankCounts[rank] === 4);
        const kicker = uniqueRanks.find(rank => rankCounts[rank] === 1);
        return { rank: 7, type: 'four-of-a-kind', tiebreaker: fourKind * 100 + kicker };
      }
      
      // è‘«èŠ¦
      if (counts[0] === 3 && counts[1] === 2) {
        const threeKind = uniqueRanks.find(rank => rankCounts[rank] === 3);
        const pair = uniqueRanks.find(rank => rankCounts[rank] === 2);
        return { rank: 6, type: 'full-house', tiebreaker: threeKind * 100 + pair };
      }
      
      // åŒèŠ±
      if (isFlush) {
        return { rank: 5, type: 'flush', tiebreaker: ranks.reduce((sum, rank, i) => sum + rank * Math.pow(100, 4-i), 0) };
      }
      
      // é¡ºå­
      if (isStraight) {
        return { rank: 4, type: 'straight', tiebreaker: ranks[0] };
      }
      
      // ä¸‰æ¡
      if (counts[0] === 3) {
        const threeKind = uniqueRanks.find(rank => rankCounts[rank] === 3);
        const kickers = uniqueRanks.filter(rank => rankCounts[rank] === 1).sort((a, b) => b - a);
        return { rank: 3, type: 'three-of-a-kind', tiebreaker: threeKind * 10000 + kickers[0] * 100 + kickers[1] };
      }
      
      // ä¸¤å¯¹
      if (counts[0] === 2 && counts[1] === 2) {
        const pairs = uniqueRanks.filter(rank => rankCounts[rank] === 2).sort((a, b) => b - a);
        const kicker = uniqueRanks.find(rank => rankCounts[rank] === 1);
        return { rank: 2, type: 'two-pair', tiebreaker: pairs[0] * 10000 + pairs[1] * 100 + kicker };
      }
      
      // ä¸€å¯¹
      if (counts[0] === 2) {
        const pair = uniqueRanks.find(rank => rankCounts[rank] === 2);
        const kickers = uniqueRanks.filter(rank => rankCounts[rank] === 1).sort((a, b) => b - a);
        return { rank: 1, type: 'pair', tiebreaker: pair * 1000000 + kickers[0] * 10000 + kickers[1] * 100 + kickers[2] };
      }
      
      // é«˜ç‰Œ
      return { rank: 0, type: 'high-card', tiebreaker: ranks.reduce((sum, rank, i) => sum + rank * Math.pow(100, 4-i), 0) };
    }
    
    // æ£€æŸ¥é¡ºå­
    function checkStraight(ranks) {
      // æ£€æŸ¥A-2-3-4-5çš„ç‰¹æ®Šæƒ…å†µ
      if (ranks.join(',') === '14,5,4,3,2') return true;
      
      for (let i = 0; i < ranks.length - 1; i++) {
        if (ranks[i] - ranks[i + 1] !== 1) return false;
      }
      return true;
    }
    
    // è·å–ç»„åˆ
    function getCombinations(arr, k) {
      if (k === 1) return arr.map(item => [item]);
      if (k === arr.length) return [arr];
      
      const combinations = [];
      for (let i = 0; i <= arr.length - k; i++) {
        const head = arr[i];
        const tailCombinations = getCombinations(arr.slice(i + 1), k - 1);
        for (let tail of tailCombinations) {
          combinations.push([head, ...tail]);
        }
      }
      return combinations;
    }
    
    // åˆå§‹åŒ–æ¸¸æˆ
    init();
  </script>
</body>
</html>