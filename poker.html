<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Âæ∑Â∑ûÊâëÂÖã</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      touch-action: manipulation;
      user-select: none;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: white;
      overflow-x: hidden;
      position: relative;
      padding: 10px;
    }
    
    .game-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
      position: relative;
      z-index: 10;
      width: 100%;
      max-width: 800px;
    }
    
    /* È°∂ÈÉ®Âå∫ÂüüÊ†∑Âºè */
    .top-area {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      margin-bottom: 15px;
    }
    
    /* Êñ∞Ê∏∏ÊàèÊåâÈíÆÈ°∂ÈÉ®Ê†∑Âºè */
    .top-new-game-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 12px 24px;
      border-radius: 25px;
      font-size: 16px;
      font-weight: bold;
      color: white;
      text-align: center;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 1px;
      min-width: 100px;
      position: relative;
    }
    
    .top-new-game-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
    }
    
    .top-new-game-btn:active {
      transform: translateY(0);
    }
    
    .game-info {
      display: flex;
      justify-content: center;
      gap: 20px;
      flex: 1;
      max-width: 600px;
    }
    
    .info-box {
      background: rgba(0, 0, 0, 0.6);
      border-radius: 15px;
      padding: 15px 20px;
      text-align: center;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
      flex: 1;
      min-width: 120px;
    }
    
    .info-title {
      font-size: 12px;
      color: #a0a0a0;
      margin-bottom: 5px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .info-value {
      font-size: 20px;
      font-weight: bold;
      color: #fff;
    }
    
    .ai-area {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }
    
    .ai-label {
      font-size: 18px;
      font-weight: bold;
      color: #ff6b6b;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    }
    
    .ai-cards {
      display: flex;
      gap: 10px;
    }
    
    .community-area {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
      background: rgba(0, 0, 0, 0.6);
      border-radius: 15px;
      padding: 15px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
      margin: 20px 0;
    }
    
    .community-label {
      font-size: 16px;
      color: #a0a0a0;
      text-transform: uppercase;
      letter-spacing: 2px;
    }
    
    .community-cards {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: center;
    }
    
    .player-area {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      margin-top: 10px;
    }
    
    .player-label {
      font-size: 18px;
      font-weight: bold;
      color: #4ecdc4;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    }
    
    .player-cards {
      display: flex;
      gap: 10px;
    }
    
    .card {
      width: 60px;
      height: 84px;
      background: white;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
      padding: 5px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
      position: relative;
      font-weight: bold;
      transform-style: preserve-3d;
    }
    
    .card.hidden {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .card.hidden::after {
      content: 'üÇ†';
      font-size: 30px;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
    
    .card.flipping {
      animation: cardFlip 0.6s ease-in-out;
    }
    
    @keyframes cardFlip {
      0% {
        transform: rotateY(0deg);
      }
      50% {
        transform: rotateY(90deg);
      }
      100% {
        transform: rotateY(0deg);
      }
    }
    
    .card-rank {
      font-size: 14px;
      font-weight: bold;
    }
    
    .card-suit {
      font-size: 20px;
    }
    
    .card.red {
      color: #e74c3c;
    }
    
    .card.black {
      color: #2c3e50;
    }
    
    .action-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 20px;
      width: 100%;
    }
    
    .action-btn {
      padding: 12px 20px;
      border-radius: 20px;
      font-size: 16px;
      font-weight: bold;
      color: white;
      text-align: center;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 1px;
      min-width: 80px;
    }
    
    .action-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .fold-btn {
      background: linear-gradient(135deg, #e74c3c, #c0392b);
    }
    
    .call-btn {
      background: linear-gradient(135deg, #f39c12, #e67e22);
    }
    
    .raise-btn {
      background: linear-gradient(135deg, #27ae60, #229954);
    }
    
    .check-btn {
      background: linear-gradient(135deg, #3498db, #2980b9);
    }
    
    .action-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
    }
    
    .action-btn:active:not(:disabled) {
      transform: translateY(0);
    }
    
    .pot-info {
      text-align: center;
      margin: 15px 0;
      font-size: 18px;
      font-weight: bold;
      color: #f1c40f;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    }
    
    .game-status {
      text-align: center;
      margin: 10px 0;
      font-size: 16px;
      color: #ecf0f1;
      min-height: 24px;
    }
    
    .hand-strength {
      font-size: 14px;
      color: #95a5a6;
      margin-top: 5px;
      text-align: center;
    }
    
    /* ËÉåÊôØÂä®Áîª */
    .background {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      z-index: 1;
    }
    
    .shape {
      position: absolute;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      animation: float 15s infinite linear;
    }
    
    @keyframes float {
      0% {
        transform: translateY(0) rotate(0deg);
      }
      100% {
        transform: translateY(-100vh) rotate(360deg);
      }
    }
    
    /* Ëá™ÂÆö‰πâÂºπÁ™óÊ†∑Âºè */
    .custom-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      backdrop-filter: blur(10px);
    }
    
    .modal-content {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 20px;
      padding: 30px;
      text-align: center;
      color: white;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      border: 2px solid rgba(255, 255, 255, 0.3);
      max-width: 90%;
      min-width: 300px;
    }
    
    .modal-title {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 15px;
      color: #ffd700;
    }
    
    .modal-message {
      font-size: 16px;
      margin-bottom: 25px;
      line-height: 1.5;
    }
    
    .modal-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
    }
    
    .modal-btn {
      padding: 12px 24px;
      border: none;
      border-radius: 25px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      min-width: 100px;
    }
    
    .modal-btn.confirm {
      background: linear-gradient(135deg, #ff6b6b, #ee5a52);
      color: white;
    }
    
    .modal-btn.cancel {
      background: linear-gradient(135deg, #4ecdc4, #44a08d);
      color: white;
    }
    
    .modal-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    }
    
    /* ÂìçÂ∫îÂºèËÆæËÆ° */
    @media (max-width: 480px) {
      .top-area {
        flex-direction: column;
        gap: 15px;
        align-items: stretch;
      }
      
      .game-info {
        order: 2;
      }
      
      .top-new-game-btn {
        order: 1;
        align-self: center;
        padding: 10px 20px;
        font-size: 14px;
        min-width: 90px;
      }
      
      .card {
        width: 50px;
        height: 70px;
        padding: 3px;
      }
      
      .card-rank {
        font-size: 12px;
      }
      
      .card-suit {
        font-size: 16px;
      }
      
      .action-btn {
        padding: 10px 15px;
        font-size: 14px;
        min-width: 70px;
      }
      
      .info-value {
        font-size: 18px;
      }
      
      .community-cards {
        gap: 5px;
      }
      
      .ai-cards, .player-cards {
        gap: 8px;
      }
      
      .modal-content {
        padding: 20px;
        min-width: 280px;
      }
      
      .modal-title {
        font-size: 20px;
      }
      
      .modal-message {
        font-size: 14px;
      }
      
      .modal-btn {
        padding: 10px 20px;
        font-size: 14px;
        min-width: 80px;
      }
      
      .winner-text {
        font-size: 28px;
      }
      
      .winner-details {
        font-size: 16px;
      }
      
      .winner-card {
        width: 40px;
        height: 56px;
        padding: 3px;
      }
      
      .winner-card-rank {
        font-size: 10px;
      }
      
      .winner-card-suit {
        font-size: 14px;
      }
      
      .winner-cards-row {
        gap: 5px;
      }
      
      .next-round-btn {
        padding: 12px 24px;
        font-size: 16px;
      }
    }
    
    .winner-announcement {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 100;
      display: none;
      padding: 20px;
      overflow-y: auto;
    }
    
    .winner-text {
      font-size: 36px;
      font-weight: bold;
      margin-bottom: 20px;
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
    }
    
    .winner-details {
      font-size: 18px;
      margin-bottom: 30px;
      text-align: center;
    }
    
    /* ÂÆåÁªìÂºπÁ™ó‰∏≠ÁöÑÁâåÈù¢Â±ïÁ§∫Âå∫Âüü */
    .winner-cards-container {
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin: 20px 0;
      width: 100%;
      max-width: 600px;
    }
    
    .winner-player-section {
      background: rgba(0, 0, 0, 0.6);
      border-radius: 15px;
      padding: 15px;
      text-align: center;
    }
    
    .winner-player-label {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 10px;
      color: #4ecdc4;
    }
    
    .winner-player-label.ai {
      color: #ff6b6b;
    }
    
    .winner-cards-row {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-bottom: 10px;
    }
    
    .winner-card {
      width: 50px;
      height: 70px;
      background: white;
      border-radius: 6px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
      padding: 4px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      font-weight: bold;
      font-size: 12px;
    }
    
    .winner-card.red {
      color: #e74c3c;
    }
    
    .winner-card.black {
      color: #2c3e50;
    }
    
    .winner-card-rank {
      font-size: 11px;
      font-weight: bold;
    }
    
    .winner-card-suit {
      font-size: 16px;
    }
    
    .winner-hand-strength {
      font-size: 14px;
      color: #f1c40f;
      font-weight: bold;
    }
    
    .winner-community-section {
      background: rgba(0, 0, 0, 0.6);
      border-radius: 15px;
      padding: 15px;
      text-align: center;
    }
    
    .winner-community-label {
      font-size: 16px;
      color: #a0a0a0;
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 2px;
    }
    
    /* ‰ºòÂåñ"‰∏ã‰∏ÄÂ±Ä"ÊåâÈíÆÊ†∑Âºè - Â±Ö‰∏≠ÊòæÁ§∫ */
    .next-round-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 15px 30px;
      font-size: 18px;
      border-radius: 25px;
      font-weight: bold;
      color: white;
      text-align: center;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 1px;
      min-width: 120px;
    }
    
    .next-round-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }
  </style>
</head>
<body>
  <div class="background" id="background"></div>
  
  <!-- Ëá™ÂÆö‰πâÂºπÁ™ó -->
  <div class="custom-modal" id="customModal">
    <div class="modal-content">
      <div class="modal-title" id="modalTitle">Á°ÆËÆ§Êìç‰Ωú</div>
      <div class="modal-message" id="modalMessage">ÊÇ®Á°ÆÂÆöË¶ÅÊâßË°åÊ≠§Êìç‰ΩúÂêóÔºü</div>
      <div class="modal-buttons">
        <button class="modal-btn confirm" id="modalConfirm">Á°ÆËÆ§</button>
        <button class="modal-btn cancel" id="modalCancel">ÂèñÊ∂à</button>
      </div>
    </div>
  </div>
  
  <div class="game-container">
    <!-- È°∂ÈÉ®Âå∫ÂüüÔºöÊñ∞Ê∏∏ÊàèÊåâÈíÆÂíåÊ∏∏Êàè‰ø°ÊÅØ -->
    <div class="top-area">
      <button class="top-new-game-btn" id="newGameBtn">Êñ∞Ê∏∏Êàè</button>
      
      <!-- Ê∏∏Êàè‰ø°ÊÅØ -->
      <div class="game-info">
        <div class="info-box">
          <div class="info-title">Áé©ÂÆ∂Á≠πÁ†Å</div>
          <div class="info-value" id="playerChips">1000</div>
        </div>
        
        <div class="info-box">
          <div class="info-title">Â∫ïÊ±†</div>
          <div class="info-value" id="pot">0</div>
        </div>
        
        <div class="info-box">
          <div class="info-title">AIÁ≠πÁ†Å</div>
          <div class="info-value" id="aiChips">1000</div>
        </div>
      </div>
    </div>
    
    <!-- Ê∏∏ÊàèÁä∂ÊÄÅ -->
    <div class="game-status" id="gameStatus">ÁÇπÂáªÊñ∞Ê∏∏ÊàèÂºÄÂßã</div>
    
    <!-- AIÂå∫Âüü -->
    <div class="ai-area">
      <div class="ai-label">AI ÂØπÊâã</div>
      <div class="ai-cards" id="aiCards">
        <div class="card hidden"></div>
        <div class="card hidden"></div>
      </div>
      <div class="hand-strength" id="aiHandStrength"></div>
    </div>
    
    <!-- ÂÖ¨ÂÖ±ÁâåÂå∫Âüü -->
    <div class="community-area">
      <div class="community-label">ÂÖ¨ÂÖ±Áâå</div>
      <div class="community-cards" id="communityCards">
        <div class="card hidden"></div>
        <div class="card hidden"></div>
        <div class="card hidden"></div>
        <div class="card hidden"></div>
        <div class="card hidden"></div>
      </div>
    </div>
    
    <!-- Áé©ÂÆ∂Âå∫Âüü -->
    <div class="player-area">
      <div class="player-label">Áé©ÂÆ∂</div>
      <div class="player-cards" id="playerCards">
        <div class="card hidden"></div>
        <div class="card hidden"></div>
      </div>
      <div class="hand-strength" id="playerHandStrength"></div>
    </div>
    
    <!-- Êìç‰ΩúÊåâÈíÆ -->
    <div class="action-buttons">
      <button class="action-btn fold-btn" id="foldBtn" disabled>ÂºÉÁâå</button>
      <button class="action-btn check-btn" id="checkBtn" disabled>ËøáÁâå</button>
      <button class="action-btn call-btn" id="callBtn" disabled>Ë∑üÊ≥®</button>
      <button class="action-btn raise-btn" id="raiseBtn" disabled>Âä†Ê≥®</button>
    </div>
  </div>
  
  <!-- Ëé∑ËÉúËÄÖÂÖ¨Âëä -->
  <div class="winner-announcement" id="winnerAnnouncement">
    <div class="winner-text" id="winnerText"></div>
    <div class="winner-details" id="winnerDetails"></div>
    
    <!-- ÁâåÈù¢Â±ïÁ§∫Âå∫Âüü -->
    <div class="winner-cards-container" id="winnerCardsContainer">
      <!-- AIÁâåÈù¢ -->
      <div class="winner-player-section">
        <div class="winner-player-label ai">AI ÂØπÊâã</div>
        <div class="winner-cards-row" id="winnerAiCards"></div>
        <div class="winner-hand-strength" id="winnerAiHandStrength"></div>
      </div>
      
      <!-- ÂÖ¨ÂÖ±Áâå -->
      <div class="winner-community-section">
        <div class="winner-community-label">ÂÖ¨ÂÖ±Áâå</div>
        <div class="winner-cards-row" id="winnerCommunityCards"></div>
      </div>
      
      <!-- Áé©ÂÆ∂ÁâåÈù¢ -->
      <div class="winner-player-section">
        <div class="winner-player-label">Áé©ÂÆ∂</div>
        <div class="winner-cards-row" id="winnerPlayerCards"></div>
        <div class="winner-hand-strength" id="winnerPlayerHandStrength"></div>
      </div>
    </div>
    
    <button class="next-round-btn" id="nextRoundBtn">‰∏ã‰∏ÄÂ±Ä</button>
  </div>

  <script>
    // Ê∏∏ÊàèÁä∂ÊÄÅ
    let gameState = {
      deck: [],
      playerCards: [],
      aiCards: [],
      communityCards: [],
      playerChips: 1000,
      aiChips: 1000,
      pot: 0,
      currentBet: 0,
      playerBet: 0,
      aiBet: 0,
      gamePhase: 'preflop', // preflop, flop, turn, river, showdown
      gameActive: false,
      playerTurn: true,
      isFirstGame: true // Êñ∞Â¢ûÔºöÊ†áËÆ∞ÊòØÂê¶‰∏∫È¶ñÊ¨°Ê∏∏Êàè
    };
    
    // ÊâëÂÖãÁâåÂÆö‰πâ
    const suits = ['‚ô†', '‚ô•', '‚ô¶', '‚ô£'];
    const ranks = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
    const rankValues = {
      '2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, '9': 9, '10': 10,
      'J': 11, 'Q': 12, 'K': 13, 'A': 14
    };
    
    // ÊâãÁâåÂº∫Â∫¶ÂêçÁß∞
    const handNames = {
      'high-card': 'È´òÁâå',
      'pair': '‰∏ÄÂØπ',
      'two-pair': '‰∏§ÂØπ',
      'three-of-a-kind': '‰∏âÊù°',
      'straight': 'È°∫Â≠ê',
      'flush': 'ÂêåËä±',
      'full-house': 'Ëë´Ëä¶',
      'four-of-a-kind': 'ÂõõÊù°',
      'straight-flush': 'ÂêåËä±È°∫',
      'royal-flush': 'ÁöáÂÆ∂ÂêåËä±È°∫'
    };
    
    // ÂºπÁ™óÁõ∏ÂÖ≥ÂèòÈáè
    let modalCallback = null;
    
    // ÊÄßËÉΩ‰ºòÂåñÔºöÁºìÂ≠òDOMÂÖÉÁ¥†
    const domCache = {
      playerChips: null,
      aiChips: null,
      pot: null,
      gameStatus: null,
      playerCards: null,
      aiCards: null,
      communityCards: null,
      playerHandStrength: null,
      aiHandStrength: null,
      foldBtn: null,
      checkBtn: null,
      callBtn: null,
      raiseBtn: null
    };
    
    // ÂàùÂßãÂåñÊ∏∏Êàè
    function init() {
      // ÁºìÂ≠òDOMÂÖÉÁ¥†‰ª•ÊèêÈ´òÊÄßËÉΩ
      domCache.playerChips = document.getElementById('playerChips');
      domCache.aiChips = document.getElementById('aiChips');
      domCache.pot = document.getElementById('pot');
      domCache.gameStatus = document.getElementById('gameStatus');
      domCache.playerCards = document.getElementById('playerCards');
      domCache.aiCards = document.getElementById('aiCards');
      domCache.communityCards = document.getElementById('communityCards');
      domCache.playerHandStrength = document.getElementById('playerHandStrength');
      domCache.aiHandStrength = document.getElementById('aiHandStrength');
      domCache.foldBtn = document.getElementById('foldBtn');
      domCache.checkBtn = document.getElementById('checkBtn');
      domCache.callBtn = document.getElementById('callBtn');
      domCache.raiseBtn = document.getElementById('raiseBtn');
      
      createBackground();
      setupEventListeners();
      updateDisplay();
    }
    
    // ÂàõÂª∫Âä®ÊÄÅËÉåÊôØ
    function createBackground() {
      const bg = document.getElementById('background');
      const colors = ['rgba(255,255,255,0.05)', 'rgba(255,255,255,0.03)', 'rgba(255,255,255,0.02)'];
      
      for (let i = 0; i < 15; i++) {
        const shape = document.createElement('div');
        shape.classList.add('shape');
        
        const size = Math.random() * 80 + 40;
        shape.style.width = `${size}px`;
        shape.style.height = `${size}px`;
        shape.style.left = `${Math.random() * 100}%`;
        shape.style.top = `${Math.random() * 100}%`;
        shape.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        shape.style.animationDuration = `${Math.random() * 25 + 20}s`;
        shape.style.animationDelay = `${Math.random() * 5}s`;
        
        bg.appendChild(shape);
      }
    }
    
    // ÊòæÁ§∫Ëá™ÂÆö‰πâÂºπÁ™ó
    function showCustomModal(title, message, onConfirm) {
      document.getElementById('modalTitle').textContent = title;
      document.getElementById('modalMessage').textContent = message;
      document.getElementById('customModal').style.display = 'flex';
      modalCallback = onConfirm;
    }
    
    // ÈöêËóèËá™ÂÆö‰πâÂºπÁ™ó
    function hideCustomModal() {
      document.getElementById('customModal').style.display = 'none';
      modalCallback = null;
    }
    
    // ËÆæÁΩÆ‰∫ã‰ª∂ÁõëÂê¨Âô®
    function setupEventListeners() {
      document.getElementById('newGameBtn').addEventListener('click', () => {
        // È¶ñÊ¨°ÁÇπÂáª‰∏çÂºπÁ™óÔºåÁõ¥Êé•ÂºÄÂßãÊ∏∏Êàè
        if (gameState.isFirstGame) {
          gameState.isFirstGame = false;
          startNewGame();
        } else {
          // ÈùûÈ¶ñÊ¨°ÁÇπÂáªÊâçÂºπÁ™óÁ°ÆËÆ§
          showCustomModal(
            'ÂºÄÂßãÊñ∞Ê∏∏Êàè',
            'Á°ÆÂÆöË¶ÅÂºÄÂßãÊñ∞Ê∏∏ÊàèÂêóÔºüÂΩìÂâçËøõÂ∫¶Â∞Ü‰ºö‰∏¢Â§±„ÄÇ',
            () => {
              hideCustomModal();
              startNewGame();
            }
          );
        }
      });
      
      document.getElementById('foldBtn').addEventListener('click', () => {
        showCustomModal(
          'Á°ÆËÆ§ÂºÉÁâå',
          'Á°ÆÂÆöË¶ÅÂºÉÁâåÂêóÔºüÊÇ®Â∞ÜÂ§±ÂéªÊú¨ËΩÆÁöÑÊâÄÊúâÁ≠πÁ†Å„ÄÇ',
          () => {
            hideCustomModal();
            playerAction('fold');
          }
        );
      });
      
      document.getElementById('checkBtn').addEventListener('click', () => playerAction('check'));
      document.getElementById('callBtn').addEventListener('click', () => playerAction('call'));
      document.getElementById('raiseBtn').addEventListener('click', () => playerAction('raise'));
      document.getElementById('nextRoundBtn').addEventListener('click', startNewRound);
      
      // ÂºπÁ™óÊåâÈíÆ‰∫ã‰ª∂
      document.getElementById('modalConfirm').addEventListener('click', () => {
        if (modalCallback) {
          modalCallback();
        }
      });
      
      document.getElementById('modalCancel').addEventListener('click', hideCustomModal);
      
      // ÁÇπÂáªÂºπÁ™óÂ§ñÈÉ®ÂÖ≥Èó≠
      document.getElementById('customModal').addEventListener('click', (e) => {
        if (e.target === document.getElementById('customModal')) {
          hideCustomModal();
        }
      });
    }
    
    // ÂàõÂª∫Êñ∞ÁâåÁªÑ
    function createDeck() {
      const deck = [];
      for (let suit of suits) {
        for (let rank of ranks) {
          deck.push({ suit, rank, color: (suit === '‚ô•' || suit === '‚ô¶') ? 'red' : 'black' });
        }
      }
      return shuffleDeck(deck);
    }
    
    // Ê¥óÁâå
    function shuffleDeck(deck) {
      for (let i = deck.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [deck[i], deck[j]] = [deck[j], deck[i]];
      }
      return deck;
    }
    
    // ÂºÄÂßãÊñ∞Ê∏∏Êàè
    function startNewGame() {
      gameState = {
        ...gameState, // ‰øùÁïô isFirstGame Áä∂ÊÄÅ
        deck: createDeck(),
        playerCards: [],
        aiCards: [],
        communityCards: [],
        playerChips: 1000,
        aiChips: 1000,
        pot: 0,
        currentBet: 0,
        playerBet: 0,
        aiBet: 0,
        gamePhase: 'preflop',
        gameActive: true,
        playerTurn: true
      };
      
      startNewRound();
    }
    
    // ÂºÄÂßãÊñ∞‰∏ÄËΩÆ
    function startNewRound() {
      if (gameState.playerChips <= 0) {
        showWinner('AIËé∑ËÉúÔºÅ', '‰Ω†ÁöÑÁ≠πÁ†ÅÁî®ÂÆå‰∫ÜÔºÅ');
        return;
      }
      
      if (gameState.aiChips <= 0) {
        showWinner('Áé©ÂÆ∂Ëé∑ËÉúÔºÅ', 'AIÁöÑÁ≠πÁ†ÅÁî®ÂÆå‰∫ÜÔºÅ');
        return;
      }
      
      // ÈáçÁΩÆËΩÆÊ¨°Áä∂ÊÄÅ
      gameState.deck = createDeck();
      gameState.playerCards = [];
      gameState.aiCards = [];
      gameState.communityCards = [];
      gameState.pot = 0;
      gameState.currentBet = 10; // Â∞èÁõ≤Ê≥®
      gameState.playerBet = 5; // Â∞èÁõ≤Ê≥®
      gameState.aiBet = 10; // Â§ßÁõ≤Ê≥®
      gameState.gamePhase = 'preflop';
      gameState.gameActive = true;
      gameState.playerTurn = true;
      
      // Êâ£Èô§Áõ≤Ê≥®
      gameState.playerChips -= 5;
      gameState.aiChips -= 10;
      gameState.pot = 15;
      
      // ÂèëÁâå
      dealCards();
      updateDisplay();
      updateGameStatus('‰Ω†ÁöÑÂõûÂêà - ÈÄâÊã©Ë°åÂä®');
      
      document.getElementById('winnerAnnouncement').style.display = 'none';
    }
    
    // ÂèëÁâå
    function dealCards() {
      // ÁªôÁé©ÂÆ∂ÂíåAIÂêÑÂèë‰∏§Âº†Áâå
      for (let i = 0; i < 2; i++) {
        gameState.playerCards.push(gameState.deck.pop());
        gameState.aiCards.push(gameState.deck.pop());
      }
    }
    
    // Áé©ÂÆ∂Ë°åÂä®
    function playerAction(action) {
      if (!gameState.gameActive || !gameState.playerTurn) return;
      
      switch (action) {
        case 'fold':
          gameState.aiChips += gameState.pot;
          showWinner('AIËé∑ËÉúÔºÅ', '‰Ω†ÂºÉÁâå‰∫Ü');
          return;
          
        case 'check':
          if (gameState.playerBet === gameState.aiBet) {
            gameState.playerTurn = false;
            setTimeout(() => aiAction(), 1000);
          }
          break;
          
        case 'call':
          const callAmount = gameState.aiBet - gameState.playerBet;
          if (gameState.playerChips >= callAmount) {
            gameState.playerChips -= callAmount;
            gameState.playerBet += callAmount;
            gameState.pot += callAmount;
            gameState.playerTurn = false;
            setTimeout(() => aiAction(), 1000);
          }
          break;
          
        case 'raise':
          const raiseAmount = 20;
          const totalAmount = gameState.aiBet - gameState.playerBet + raiseAmount;
          if (gameState.playerChips >= totalAmount) {
            gameState.playerChips -= totalAmount;
            gameState.playerBet += totalAmount;
            gameState.pot += totalAmount;
            gameState.currentBet = gameState.playerBet;
            gameState.playerTurn = false;
            setTimeout(() => aiAction(), 1000);
          }
          break;
      }
      
      updateDisplay();
    }
    
    // AIË°åÂä® - ÊûÅÂ§ßÈôç‰ΩéÂºÉÁâåÊ¶ÇÁéáÁöÑË∂ÖÊøÄËøõÁÆóÊ≥ï
    function aiAction() {
      if (!gameState.gameActive) return;
      
      const aiHandStrength = evaluateHand([...gameState.aiCards, ...gameState.communityCards]);
      const random = Math.random();
      
      // ËÆ°ÁÆóÂΩìÂâçÂ∫ïÊ±†ËµîÁéáÂíåÊâÄÈúÄË∑üÊ≥®ÈáëÈ¢ù
      const callAmount = gameState.playerBet - gameState.aiBet;
      const potOdds = callAmount > 0 ? gameState.pot / callAmount : 0;
      
      // ËØÑ‰º∞Ëµ∑ÊâãÁâåË¥®ÈáèÔºà‰ªÖÂú®preflopÈò∂ÊÆµÔºâ
      let preflopStrength = 0;
      if (gameState.gamePhase === 'preflop') {
        preflopStrength = evaluatePreflopHand(gameState.aiCards);
      }
      
      // Ê†πÊçÆÊ∏∏ÊàèÈò∂ÊÆµË∞ÉÊï¥Á≠ñÁï•
      let aggressionLevel = getAggressionLevel(gameState.gamePhase, aiHandStrength, preflopStrength);
      
      if (gameState.playerBet > gameState.aiBet) {
        // ÈúÄË¶ÅË∑üÊ≥®ÁöÑÊÉÖÂÜµ - ÊûÅÂ§ßÈôç‰ΩéÂºÉÁâåÊ¶ÇÁéáÔºåAIÂá†‰πé‰∏çÂºÉÁâå
        let shouldCall = false;
        
        if (gameState.gamePhase === 'preflop') {
          // PreflopÈò∂ÊÆµÔºöÂü∫‰∫éËµ∑ÊâãÁâåË¥®ÈáèÂÜ≥Á≠ñ - ÊûÅÈ´òË∑üÊ≥®Ê¶ÇÁéá
          if (preflopStrength >= 8 || // È°∂Á∫ßËµ∑ÊâãÁâåÔºàAA, KK, QQ, AKÁ≠âÔºâ
              (preflopStrength >= 6 && random < 0.99) || // Âº∫Ëµ∑ÊâãÁâåÔºå99%Ë∑üÊ≥®
              (preflopStrength >= 4 && random < 0.95) || // ‰∏≠Á≠âËµ∑ÊâãÁâåÔºå95%Ë∑üÊ≥®
              (preflopStrength >= 2 && random < 0.9) || // Âº±Ëµ∑ÊâãÁâåÔºå90%Ë∑üÊ≥®
              (preflopStrength >= 1 && random < 0.85) || // ÂæàÂº±Ëµ∑ÊâãÁâåÔºå85%Ë∑üÊ≥®
              (potOdds > 1.5 && random < 0.8) || // Â∫ïÊ±†ËµîÁéá‰∏ÄËà¨Ôºå80%Ë∑üÊ≥®
              random < 0.75) { // Âç≥‰ΩøÂæàÂ∑ÆÁöÑÁâå‰πüÊúâ75%Ê¶ÇÁéáË∑üÊ≥®
            shouldCall = true;
          }
        } else {
          // FlopÂêéÈò∂ÊÆµÔºöÂü∫‰∫éÂÆûÈôÖÁâåÂäõÂÜ≥Á≠ñ - ÊûÅÈ´òË∑üÊ≥®Ê¶ÇÁéá
          if (aiHandStrength.rank >= 6 || // Ëë´Ëä¶Âèä‰ª•‰∏ä
              (aiHandStrength.rank >= 4 && random < 0.99) || // È°∫Â≠ê/ÂêåËä±Ôºå99%Ë∑üÊ≥®
              (aiHandStrength.rank >= 2 && random < 0.95) || // ‰∏§ÂØπÂèä‰ª•‰∏äÔºå95%Ë∑üÊ≥®
              (aiHandStrength.rank >= 1 && random < 0.9) || // ‰∏ÄÂØπÔºå90%Ë∑üÊ≥®
              (aiHandStrength.rank === 0 && potOdds > 2 && random < 0.8) || // È´òÁâå‰ΩÜÂ∫ïÊ±†ËµîÁéáÂ•ΩÔºå80%Ë∑üÊ≥®
              (aiHandStrength.rank === 0 && random < 0.7)) { // È´òÁâåÔºå70%Ë∑üÊ≥®
            shouldCall = true;
          }
        }
        
        if (shouldCall) {
          if (gameState.aiChips >= callAmount) {
            gameState.aiChips -= callAmount;
            gameState.aiBet += callAmount;
            gameState.pot += callAmount;
            updateGameStatus('AIË∑üÊ≥®‰∫Ü');
            
            // Ë∑üÊ≥®ÂêéËÄÉËôëÊòØÂê¶ÂèçÂä†Ê≥®
            if (aggressionLevel > 6 && random < 0.4 && gameState.aiChips >= 20) {
              setTimeout(() => {
                const raiseAmount = Math.min(20, gameState.aiChips);
                gameState.aiChips -= raiseAmount;
                gameState.aiBet += raiseAmount;
                gameState.pot += raiseAmount;
                gameState.currentBet = gameState.aiBet;
                updateGameStatus('AIÂèçÂä†Ê≥®‰∫ÜÔºÅ‰Ω†ÁöÑÂõûÂêà');
                gameState.playerTurn = true;
                updateDisplay();
              }, 500);
              return;
            }
          } else {
            // Á≠πÁ†Å‰∏çÂ§üË∑üÊ≥®ÔºåÂÖ®Êäº
            gameState.pot += gameState.aiChips;
            gameState.aiBet += gameState.aiChips;
            gameState.aiChips = 0;
            updateGameStatus('AIÂÖ®Êäº‰∫ÜÔºÅ');
          }
        } else {
          // ÊûÅÂ∞ëÊï∞ÊÉÖÂÜµ‰∏ãÂºÉÁâå
          gameState.playerChips += gameState.pot;
          showWinner('Áé©ÂÆ∂Ëé∑ËÉúÔºÅ', 'AIÂºÉÁâå‰∫Ü');
          return;
        }
      } else {
        // ‰∏çÈúÄË¶ÅË∑üÊ≥®ÁöÑÊÉÖÂÜµÔºåËÄÉËôëÂä†Ê≥®ÊàñËøáÁâå
        let raiseChance = 0;
        
        if (gameState.gamePhase === 'preflop') {
          // PreflopÂä†Ê≥®Á≠ñÁï• - ÊûÅÈ´òÂä†Ê≥®Ê¶ÇÁéá
          if (preflopStrength >= 9) raiseChance = 0.98; // È°∂Á∫ßÁâå98%Âä†Ê≥®
          else if (preflopStrength >= 7) raiseChance = 0.85; // Âº∫Áâå85%Âä†Ê≥®
          else if (preflopStrength >= 5) raiseChance = 0.6; // ‰∏≠Á≠âÁâå60%Âä†Ê≥®
          else if (preflopStrength >= 3) raiseChance = 0.4; // Âº±Áâå40%Âä†Ê≥®ÔºàËôöÂº†Â£∞ÂäøÔºâ
          else raiseChance = 0.3; // ÂæàÂº±Áâå30%Âä†Ê≥®ÔºàËôöÂº†Â£∞ÂäøÔºâ
        } else {
          // FlopÂêéÂä†Ê≥®Á≠ñÁï• - ÊûÅÈ´òÂä†Ê≥®Ê¶ÇÁéá
          if (aiHandStrength.rank >= 7) raiseChance = 0.99; // ÂõõÊù°Âèä‰ª•‰∏ä99%Âä†Ê≥®
          else if (aiHandStrength.rank >= 5) raiseChance = 0.9; // ÂêåËä±Âèä‰ª•‰∏ä90%Âä†Ê≥®
          else if (aiHandStrength.rank >= 3) raiseChance = 0.75; // ‰∏âÊù°Âèä‰ª•‰∏ä75%Âä†Ê≥®
          else if (aiHandStrength.rank >= 2) raiseChance = 0.6; // ‰∏§ÂØπ60%Âä†Ê≥®
          else if (aiHandStrength.rank >= 1) raiseChance = 0.4; // ‰∏ÄÂØπ40%Âä†Ê≥®
          else raiseChance = 0.3; // È´òÁâå30%Âä†Ê≥®ÔºàËôöÂº†Â£∞ÂäøÔºâ
        }
        
        if (random < raiseChance) {
          const raiseAmount = Math.min(20 + Math.floor(aggressionLevel * 5), gameState.aiChips);
          if (gameState.aiChips >= raiseAmount) {
            gameState.aiChips -= raiseAmount;
            gameState.aiBet += raiseAmount;
            gameState.pot += raiseAmount;
            gameState.currentBet = gameState.aiBet;
            updateGameStatus('AIÂä†Ê≥®‰∫ÜÔºÅ‰Ω†ÁöÑÂõûÂêà');
            gameState.playerTurn = true;
            updateDisplay();
            return;
          }
        }
        updateGameStatus('AIËøáÁâå');
      }
      
      // ËøõÂÖ•‰∏ã‰∏ÄÈò∂ÊÆµ
      nextPhase();
    }
    
    // ËØÑ‰º∞Ëµ∑ÊâãÁâåË¥®ÈáèÔºàpreflop‰∏ìÁî®Ôºâ
    function evaluatePreflopHand(cards) {
      if (cards.length !== 2) return 0;
      
      const card1 = cards[0];
      const card2 = cards[1];
      const rank1 = rankValues[card1.rank];
      const rank2 = rankValues[card2.rank];
      const suited = card1.suit === card2.suit;
      const gap = Math.abs(rank1 - rank2);
      
      let strength = 0;
      
      // ÂØπÂ≠ê
      if (rank1 === rank2) {
        if (rank1 >= 14) strength = 10; // AA
        else if (rank1 >= 13) strength = 9; // KK
        else if (rank1 >= 12) strength = 8; // QQ
        else if (rank1 >= 11) strength = 7; // JJ
        else if (rank1 >= 10) strength = 6; // TT
        else if (rank1 >= 8) strength = 5; // 88-99
        else if (rank1 >= 6) strength = 4; // 66-77
        else strength = 3; // 22-55
      } else {
        // ÈùûÂØπÂ≠ê
        const highCard = Math.max(rank1, rank2);
        const lowCard = Math.min(rank1, rank2);
        
        // AK, AQ, AJÁ≠â
        if (highCard === 14) {
          if (lowCard >= 13) strength = suited ? 9 : 8; // AK
          else if (lowCard >= 12) strength = suited ? 8 : 7; // AQ
          else if (lowCard >= 11) strength = suited ? 7 : 6; // AJ
          else if (lowCard >= 10) strength = suited ? 6 : 5; // AT
          else if (lowCard >= 8) strength = suited ? 5 : 4; // A8-A9
          else strength = suited ? 4 : 2; // A2-A7
        }
        // KQ, KJÁ≠â
        else if (highCard === 13) {
          if (lowCard >= 12) strength = suited ? 7 : 6; // KQ
          else if (lowCard >= 11) strength = suited ? 6 : 5; // KJ
          else if (lowCard >= 10) strength = suited ? 5 : 4; // KT
          else strength = suited ? 3 : 2; // K2-K9
        }
        // QJ, QTÁ≠â
        else if (highCard === 12) {
          if (lowCard >= 11) strength = suited ? 6 : 5; // QJ
          else if (lowCard >= 10) strength = suited ? 5 : 4; // QT
          else strength = suited ? 3 : 2; // Q2-Q9
        }
        // JTÁ≠â
        else if (highCard === 11 && lowCard >= 10) {
          strength = suited ? 5 : 4; // JT
        }
        // ËøûÁâå
        else if (gap === 1 && highCard >= 8) {
          strength = suited ? 4 : 3; // ËøûÁâå
        }
        // ÂêåËä±Áâå
        else if (suited && highCard >= 10) {
          strength = 3;
        }
        // ÂÖ∂‰ªñ
        else {
          strength = suited ? 2 : 1;
        }
      }
      
      return strength;
    }
    
    // Ëé∑ÂèñÊøÄËøõÁ®ãÂ∫¶
    function getAggressionLevel(phase, handStrength, preflopStrength) {
      let level = 5; // Âü∫Á°ÄÊøÄËøõÁ®ãÂ∫¶
      
      if (phase === 'preflop') {
        level = Math.max(1, preflopStrength);
      } else {
        level = Math.max(1, handStrength.rank + 2);
      }
      
      // Ê†πÊçÆÁ≠πÁ†ÅÊØî‰æãË∞ÉÊï¥
      const chipRatio = gameState.aiChips / (gameState.aiChips + gameState.playerChips);
      if (chipRatio < 0.3) level += 2; // Á≠πÁ†ÅÂ∞ëÊó∂Êõ¥ÊøÄËøõ
      else if (chipRatio > 0.7) level += 1; // Á≠πÁ†ÅÂ§öÊó∂Á®çÂæÆÊøÄËøõ
      
      return Math.min(10, level);
    }
    
    // ËøõÂÖ•‰∏ã‰∏ÄÈò∂ÊÆµ
    function nextPhase() {
      if (gameState.gamePhase === 'preflop') {
        gameState.gamePhase = 'flop';
        dealFlop();
      } else if (gameState.gamePhase === 'flop') {
        gameState.gamePhase = 'turn';
        dealTurn();
      } else if (gameState.gamePhase === 'turn') {
        gameState.gamePhase = 'river';
        dealRiver();
      } else if (gameState.gamePhase === 'river') {
        gameState.gamePhase = 'showdown';
        showdown();
        return;
      }
      
      // ÈáçÁΩÆ‰∏ãÊ≥®
      gameState.playerBet = 0;
      gameState.aiBet = 0;
      gameState.currentBet = 0;
      gameState.playerTurn = true;
      
      updateDisplay();
      updateGameStatus('‰Ω†ÁöÑÂõûÂêà - ÈÄâÊã©Ë°åÂä®');
    }
    
    // ÂèëÁøªÁâå
    function dealFlop() {
      gameState.deck.pop(); // ÁÉßÁâå
      for (let i = 0; i < 3; i++) {
        gameState.communityCards.push(gameState.deck.pop());
      }
      
      // Ê∑ªÂä†ÁøªÁâåÂä®Áîª
      const communityCards = domCache.communityCards.children;
      for (let i = 0; i < 3; i++) {
        setTimeout(() => {
          communityCards[i].classList.add('flipping');
          setTimeout(() => {
            communityCards[i].classList.remove('flipping');
          }, 600);
        }, i * 200);
      }
    }
    
    // ÂèëËΩ¨Áâå
    function dealTurn() {
      gameState.deck.pop(); // ÁÉßÁâå
      gameState.communityCards.push(gameState.deck.pop());
      
      // Ê∑ªÂä†ËΩ¨ÁâåÂä®Áîª
      const turnCard = domCache.communityCards.children[3];
      turnCard.classList.add('flipping');
      setTimeout(() => {
        turnCard.classList.remove('flipping');
      }, 600);
    }
    
    // ÂèëÊ≤≥Áâå
    function dealRiver() {
      gameState.deck.pop(); // ÁÉßÁâå
      gameState.communityCards.push(gameState.deck.pop());
      
      // Ê∑ªÂä†Ê≤≥ÁâåÂä®Áîª
      const riverCard = domCache.communityCards.children[4];
      riverCard.classList.add('flipping');
      setTimeout(() => {
        riverCard.classList.remove('flipping');
      }, 600);
    }
    
    // ÊëäÁâå
    function showdown() {
      const playerHand = evaluateHand([...gameState.playerCards, ...gameState.communityCards]);
      const aiHand = evaluateHand([...gameState.aiCards, ...gameState.communityCards]);
      
      let winner = '';
      let details = '';
      
      if (playerHand.rank > aiHand.rank || 
          (playerHand.rank === aiHand.rank && playerHand.tiebreaker > aiHand.tiebreaker)) {
        winner = 'Áé©ÂÆ∂Ëé∑ËÉúÔºÅ';
        details = `Áé©ÂÆ∂: ${handNames[playerHand.type]} vs AI: ${handNames[aiHand.type]}`;
        gameState.playerChips += gameState.pot;
      } else if (aiHand.rank > playerHand.rank || 
                 (aiHand.rank === playerHand.rank && aiHand.tiebreaker > playerHand.tiebreaker)) {
        winner = 'AIËé∑ËÉúÔºÅ';
        details = `AI: ${handNames[aiHand.type]} vs Áé©ÂÆ∂: ${handNames[playerHand.type]}`;
        gameState.aiChips += gameState.pot;
      } else {
        winner = 'Âπ≥Â±ÄÔºÅ';
        details = `ÂèåÊñπÈÉΩÊòØ: ${handNames[playerHand.type]}`;
        gameState.playerChips += Math.floor(gameState.pot / 2);
        gameState.aiChips += Math.ceil(gameState.pot / 2);
      }
      
      showWinner(winner, details);
    }
    
    // ÊòæÁ§∫Ëé∑ËÉúËÄÖ
    function showWinner(winner, details) {
      document.getElementById('winnerText').textContent = winner;
      document.getElementById('winnerDetails').textContent = details;
      
      // ÊòæÁ§∫ÁâåÈù¢
      showWinnerCards();
      
      document.getElementById('winnerAnnouncement').style.display = 'flex';
      gameState.gameActive = false;
      
      // ÊòæÁ§∫AIÁöÑÁâå
      updateDisplay(true);
    }
    
    // ÊòæÁ§∫ÂÆåÁªìÂºπÁ™ó‰∏≠ÁöÑÁâåÈù¢
    function showWinnerCards() {
      // ÊòæÁ§∫AIÊâãÁâå
      const aiCardsContainer = document.getElementById('winnerAiCards');
      aiCardsContainer.innerHTML = '';
      gameState.aiCards.forEach(card => {
        const cardElement = createWinnerCardElement(card);
        aiCardsContainer.appendChild(cardElement);
      });
      
      // ÊòæÁ§∫Áé©ÂÆ∂ÊâãÁâå
      const playerCardsContainer = document.getElementById('winnerPlayerCards');
      playerCardsContainer.innerHTML = '';
      gameState.playerCards.forEach(card => {
        const cardElement = createWinnerCardElement(card);
        playerCardsContainer.appendChild(cardElement);
      });
      
      // ÊòæÁ§∫ÂÖ¨ÂÖ±Áâå
      const communityCardsContainer = document.getElementById('winnerCommunityCards');
      communityCardsContainer.innerHTML = '';
      gameState.communityCards.forEach(card => {
        const cardElement = createWinnerCardElement(card);
        communityCardsContainer.appendChild(cardElement);
      });
      
      // ÊòæÁ§∫ÊâãÁâåÂº∫Â∫¶
      if (gameState.playerCards.length > 0) {
        const playerHand = evaluateHand([...gameState.playerCards, ...gameState.communityCards]);
        document.getElementById('winnerPlayerHandStrength').textContent = handNames[playerHand.type];
      }
      
      if (gameState.aiCards.length > 0) {
        const aiHand = evaluateHand([...gameState.aiCards, ...gameState.communityCards]);
        document.getElementById('winnerAiHandStrength').textContent = handNames[aiHand.type];
      }
    }
    
    // ÂàõÂª∫ÂÆåÁªìÂºπÁ™ó‰∏≠ÁöÑÁâåÈù¢ÂÖÉÁ¥†
    function createWinnerCardElement(card) {
      const cardElement = document.createElement('div');
      cardElement.className = `winner-card ${card.color}`;
      cardElement.innerHTML = `
        <div class="winner-card-rank">${card.rank}</div>
        <div class="winner-card-suit">${card.suit}</div>
      `;
      return cardElement;
    }
    
    // Êõ¥Êñ∞ÊòæÁ§∫
    function updateDisplay(showAiCards = false) {
      // ‰ΩøÁî®ÁºìÂ≠òÁöÑDOMÂÖÉÁ¥†ÊèêÈ´òÊÄßËÉΩ
      domCache.playerChips.textContent = gameState.playerChips;
      domCache.aiChips.textContent = gameState.aiChips;
      domCache.pot.textContent = gameState.pot;
      
      // Êõ¥Êñ∞Áé©ÂÆ∂ÊâãÁâå
      updateCards(domCache.playerCards, gameState.playerCards, false);
      
      // Êõ¥Êñ∞AIÊâãÁâå
      updateCards(domCache.aiCards, gameState.aiCards, !showAiCards);
      
      // Êõ¥Êñ∞ÂÖ¨ÂÖ±Áâå
      updateCards(domCache.communityCards, gameState.communityCards, false);
      
      // Êõ¥Êñ∞ÊâãÁâåÂº∫Â∫¶
      if (gameState.playerCards.length > 0) {
        const playerHand = evaluateHand([...gameState.playerCards, ...gameState.communityCards]);
        domCache.playerHandStrength.textContent = handNames[playerHand.type];
      }
      
      if (showAiCards && gameState.aiCards.length > 0) {
        const aiHand = evaluateHand([...gameState.aiCards, ...gameState.communityCards]);
        domCache.aiHandStrength.textContent = handNames[aiHand.type];
      } else {
        domCache.aiHandStrength.textContent = '';
      }
      
      // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
      updateButtons();
    }
    
    // Êõ¥Êñ∞Âç°ÁâåÊòæÁ§∫
    function updateCards(container, cards, hidden) {
      const cardElements = container.children;
      
      for (let i = 0; i < cardElements.length; i++) {
        const cardElement = cardElements[i];
        
        if (i < cards.length && !hidden) {
          const card = cards[i];
          cardElement.className = `card ${card.color}`;
          cardElement.innerHTML = `
            <div class="card-rank">${card.rank}</div>
            <div class="card-suit">${card.suit}</div>
          `;
        } else {
          cardElement.className = 'card hidden';
          cardElement.innerHTML = '';
        }
      }
    }
    
    // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
    function updateButtons() {
      const isPlayerTurn = gameState.gameActive && gameState.playerTurn;
      const needToCall = gameState.playerBet < gameState.aiBet;
      
      domCache.foldBtn.disabled = !isPlayerTurn;
      domCache.checkBtn.disabled = !isPlayerTurn || needToCall;
      domCache.callBtn.disabled = !isPlayerTurn || !needToCall;
      domCache.raiseBtn.disabled = !isPlayerTurn || gameState.playerChips < 20;
      
      if (needToCall) {
        const callAmount = gameState.aiBet - gameState.playerBet;
        domCache.callBtn.textContent = `Ë∑üÊ≥® ${callAmount}`;
      } else {
        domCache.callBtn.textContent = 'Ë∑üÊ≥®';
      }
    }
    
    // Êõ¥Êñ∞Ê∏∏ÊàèÁä∂ÊÄÅ
    function updateGameStatus(status) {
      domCache.gameStatus.textContent = status;
    }
    
    // ËØÑ‰º∞ÊâãÁâå
    function evaluateHand(cards) {
      if (cards.length < 5) return { rank: 0, type: 'high-card', tiebreaker: 0 };
      
      // Ëé∑ÂèñÊâÄÊúâÂèØËÉΩÁöÑ5Âº†ÁâåÁªÑÂêà
      const combinations = getCombinations(cards, 5);
      let bestHand = { rank: 0, type: 'high-card', tiebreaker: 0 };
      
      for (let combo of combinations) {
        const hand = evaluateFiveCards(combo);
        if (hand.rank > bestHand.rank || 
            (hand.rank === bestHand.rank && hand.tiebreaker > bestHand.tiebreaker)) {
          bestHand = hand;
        }
      }
      
      return bestHand;
    }
    
    // ËØÑ‰º∞5Âº†Áâå
    function evaluateFiveCards(cards) {
      const ranks = cards.map(card => rankValues[card.rank]).sort((a, b) => b - a);
      const suits = cards.map(card => card.suit);
      
      const isFlush = suits.every(suit => suit === suits[0]);
      const isStraight = checkStraight(ranks);
      
      const rankCounts = {};
      ranks.forEach(rank => {
        rankCounts[rank] = (rankCounts[rank] || 0) + 1;
      });
      
      const counts = Object.values(rankCounts).sort((a, b) => b - a);
      const uniqueRanks = Object.keys(rankCounts).map(Number).sort((a, b) => b - a);
      
      // ÁöáÂÆ∂ÂêåËä±È°∫
      if (isFlush && isStraight && ranks[0] === 14) {
        return { rank: 9, type: 'royal-flush', tiebreaker: 0 };
      }
      
      // ÂêåËä±È°∫
      if (isFlush && isStraight) {
        return { rank: 8, type: 'straight-flush', tiebreaker: ranks[0] };
      }
      
      // ÂõõÊù°
      if (counts[0] === 4) {
        const fourKind = uniqueRanks.find(rank => rankCounts[rank] === 4);
        const kicker = uniqueRanks.find(rank => rankCounts[rank] === 1);
        return { rank: 7, type: 'four-of-a-kind', tiebreaker: fourKind * 100 + kicker };
      }
      
      // Ëë´Ëä¶
      if (counts[0] === 3 && counts[1] === 2) {
        const threeKind = uniqueRanks.find(rank => rankCounts[rank] === 3);
        const pair = uniqueRanks.find(rank => rankCounts[rank] === 2);
        return { rank: 6, type: 'full-house', tiebreaker: threeKind * 100 + pair };
      }
      
      // ÂêåËä±
      if (isFlush) {
        return { rank: 5, type: 'flush', tiebreaker: ranks.reduce((sum, rank, i) => sum + rank * Math.pow(100, 4-i), 0) };
      }
      
      // È°∫Â≠ê
      if (isStraight) {
        return { rank: 4, type: 'straight', tiebreaker: ranks[0] };
      }
      
      // ‰∏âÊù°
      if (counts[0] === 3) {
        const threeKind = uniqueRanks.find(rank => rankCounts[rank] === 3);
        const kickers = uniqueRanks.filter(rank => rankCounts[rank] === 1).sort((a, b) => b - a);
        return { rank: 3, type: 'three-of-a-kind', tiebreaker: threeKind * 10000 + kickers[0] * 100 + kickers[1] };
      }
      
      // ‰∏§ÂØπ
      if (counts[0] === 2 && counts[1] === 2) {
        const pairs = uniqueRanks.filter(rank => rankCounts[rank] === 2).sort((a, b) => b - a);
        const kicker = uniqueRanks.find(rank => rankCounts[rank] === 1);
        return { rank: 2, type: 'two-pair', tiebreaker: pairs[0] * 10000 + pairs[1] * 100 + kicker };
      }
      
      // ‰∏ÄÂØπ
      if (counts[0] === 2) {
        const pair = uniqueRanks.find(rank => rankCounts[rank] === 2);
        const kickers = uniqueRanks.filter(rank => rankCounts[rank] === 1).sort((a, b) => b - a);
        return { rank: 1, type: 'pair', tiebreaker: pair * 1000000 + kickers[0] * 10000 + kickers[1] * 100 + kickers[2] };
      }
      
      // È´òÁâå
      return { rank: 0, type: 'high-card', tiebreaker: ranks.reduce((sum, rank, i) => sum + rank * Math.pow(100, 4-i), 0) };
    }
    
    // Ê£ÄÊü•È°∫Â≠ê
    function checkStraight(ranks) {
      // Ê£ÄÊü•A-2-3-4-5ÁöÑÁâπÊÆäÊÉÖÂÜµ
      if (ranks.join(',') === '14,5,4,3,2') return true;
      
      for (let i = 0; i < ranks.length - 1; i++) {
        if (ranks[i] - ranks[i + 1] !== 1) return false;
      }
      return true;
    }
    
    // Ëé∑ÂèñÁªÑÂêà
    function getCombinations(arr, k) {
      if (k === 1) return arr.map(item => [item]);
      if (k === arr.length) return [arr];
      
      const combinations = [];
      for (let i = 0; i <= arr.length - k; i++) {
        const head = arr[i];
        const tailCombinations = getCombinations(arr.slice(i + 1), k - 1);
        for (let tail of tailCombinations) {
          combinations.push([head, ...tail]);
        }
      }
      return combinations;
    }
    
    // ÂàùÂßãÂåñÊ∏∏Êàè
    init();
  </script>
</body>
</html>